var connection_final;
var DisplayName;
var IPAddress;
var TransNumber;
var FileSize;
var AuthToken;
var SelectPage;
var pageNumbe;
var prHeight = 842;
var Pagelength;
var browserName = "";
var BioStatus;
var customselectPage;
var innertabLink = "";
var dsignsignatureValidation = false;
var OSName = "Unknown OS";
var check_value = "OTP";
var docType, IsMixedOrintation = false,
    defaultLeftPxValue = 7, defaultRightPxValue = 833, defaultHeightPxValue = 60, defaultWidthPxValue = 120, defaultInHeightPxValue = 32, defaultInWidthPxValue = 34, defaultTopPxValue = 2, defaultBottomPxValue = 5,
    PostionPageNo = 1, defaultPageLevelLeftPxValue = 10, defaultPageLevelTopPxValue = 10;
var ValidateAllPlaceholders = $("#ValidateAllPlaceholders").val();
$(document).ready(function () {
    var IsCustomized = $("#IsCustomized").val();
    $("form").attr('autocomplete', 'off');
    //SetConnectionPort(PortList);
    var SignatureMode = $("#hdnSignatureMode").val().split(',');
    var SignatureType = $("#hdnSigType").val();
    if (SignatureType == 1) {
        SignatureMode = "1,2,3,7,8,12,14";
    }
    else if (SignatureType == 2) {
        SignatureMode = "1";
    }
    else if (SignatureType == 3) {
        SignatureMode = "2";
    }
    else if (SignatureType == 4) {
        SignatureMode = "3";
    }
    else if (SignatureType == 5) {
        SignatureMode = "1,2";
    }
    else if (SignatureType == 5) {
        SignatureMode = "1,3";
    }
    else if (SignatureType == 7) {
        SignatureMode = "7";
    }
    else if (SignatureType == 8) {
        SignatureMode = "8";
    }
    else if (SignatureType == 12) {
        SignatureMode = "12";
    } else if (SignatureType == 14) {
        SignatureMode = "14";
    }
    //
    //if (SignatureType == 0) {
    $("#hdnSigType").val(SignatureMode);

    $("#signOption1").hide();
    $("#signOption2").hide();
    $("#signOption3").hide();
    $("#signOption4").hide();
    $("#signOption5").hide();
    $("#signOption6").hide();
    var divCount = 1;
    for (var sm = 0; sm < SignatureMode.length; sm++) {
        SignatureType = SignatureMode[sm];
        if (SignatureType == 1) {
            if (ValidateAllPlaceholders != "True") {
                $("#signOption2").show();
                $("#portSettingDiv").show();
            }
            if (SignatureMode.includes("2")) {
                $("#opt-divDsign").text(divCount + 1);
            }
            else {
                $("#opt-divDsign").text(divCount);
            }
            if (connection_final == null) {
                SetConnectionPort(PortList);
            }
            divCount++;
        }
        else if (SignatureType == 2) {
            if (ValidateAllPlaceholders != "True") { $("#signOption1").show(); }
            if (SignatureMode.includes("1")) {
                $("#opt-divesign").text(divCount - 1);
            }
            else {
                $("#opt-divesign").text(divCount);
            }
            $("#signerContent_1").slideDown().addClass("open");
            if ($("#hdnAadhaarNumber").val() != "") {
                var OriginalAdharNumer = $('#hdnAadhaarNumber').val();
                $("#txtAdhaarNumber").attr("disabled", true);
                var Last4digitofAadhaar = $('#hdnAadhaarNumber').val().substr(8, 11);
                $('#txtAdhaarNumber').val("XXXXXXXX" + Last4digitofAadhaar);
                $('#txtAdhaarNumber').attr("value", "XXXXXXXX" + Last4digitofAadhaar);
                $('#txtAdhaarNumber').attr("readonly", true);
            }
            else {
                $("#txtAdhaarNumber").val("");
            }
            if ($("#hdneSignAuthmode").val() == "3") {
                $("#divBiometric").show();
                $("#btnGetOtp").hide();
                $("#div-esignAuthRadio").hide();
                $("#otpdetails").slideUp();
            }
            divCount++;
        }
        else if (SignatureType == 3) {
            if (ValidateAllPlaceholders != "True") { $("#signOption3").show(); }

            $("#opt-divesignature").text(divCount);
            divCount++;
        }
        else if (SignatureType == 4) {
            divCount++;
        }
        else if (SignatureType == 5) {
            divCount++;
        }
        else if (SignatureType == 6) {
            divCount++;
        }
        else if (SignatureType == 7) {
            //$("#signOption6").hide();
            if (ValidateAllPlaceholders != "True") {
                $("#signOption5").show();
            } //to be show}
            $("#signerLink_5").attr("disabled", "disabled");
            $("#signerLink_5").off("click");

            $("#opt-divZsign").text(divCount);

            $("#portSettingDiv").show();
            divCount++;
        }
        else if (SignatureType == 8) {
            if (ValidateAllPlaceholders != "True") { $("#signOption4").show(); }
            $("#opt-divVsign").text(divCount);
            $("#portSettingDiv").show();
            divCount++;
        } else if (SignatureType == 12) {
            if (ValidateAllPlaceholders != "True") { $("#signOption7").show(); }
            $("#opt-divesignv2").text(divCount);
            divCount++;
        } else if (SignatureType == 14) {
            if (ValidateAllPlaceholders != "True") { $("#signOption14").show(); }
            $("#opt-divesignCDSL").text(divCount);
            divCount++;
        }

    }
    //}
    if (ValidateAllPlaceholders == "True") { $("#btnSignaftervalidateall,#btnvalidatecancel").show(); }
    //---Biometric code begin---
    if ($("#hdneSignAuthmode").val() == "1") {
        $("#div-esignAuthRadio").show();
        $("#divBiometric").hide();
        $("#btnGetOtp").hide();
        $("#otpdetails").slideUp();
    }
    else if ($("#hdneSignAuthmode").val() == "2") {
        $("#divBiometric").hide();
        $("#btnGetOtp").show();
        $("#div-esignAuthRadio").hide();
        $("#otpdetails").slideUp();
    }
    else {
        $("#divBiometric").show();
        $("#btnGetOtp").hide();
        $("#div-esignAuthRadio").hide();
        $("#otpdetails").slideUp();
    }
    //------End------
    if ($("#hdnFileType").val() == "PDF") {
        if ($("#SelectFontOption").val() == "True" || $("#DrawSignatureOption").val() == "True" || $("#UploadSignatureOption").val() == "True" || $("#eSignaturePadOption").val() == "True") {
            $("#btneesignature").removeAttr('disabled');
            $("#btneesignature").on("click");
            $("#addimage").show();

        }
        else {
            $("#btneesignature").attr('disabled');
            $("#btneesignature").off("click");
            $("#addimage").hide();
        }
    }
    else {
        $("#btneesignature").removeAttr('disabled');
        $("#btneesignature").on("click");
    }

    if ($("#SelectFontOption").val() == "True") {
        innertabLink = "innertabLink_1";
    } else
        if ($("#DrawSignatureOption").val() == "True") {
            innertabLink = "innertabLink_2";
        } else if ($("#UploadSignatureOption").val() == "True") {
            innertabLink = "innertabLink_3";
        } else if ($("#eSignaturePadOption").val() == "True") {
            innertabLink = "innertabLink_4";
        }

    $("#btnGetOtp").attr('value', 'Get OTP');
    DisplayName = $("#hdnName").val();
    IPAddress = $("#hdnIPAddress").val();
    TransNumber = $("#hdntransNumber").val();
    FileSize = $("#hdnFileSize").val();
    AuthToken = $("#hdnAuthToken").val();
    SelectPage = $("#hdnSelectPage").val();
    //var OSName = "Unknown OS";
    if (navigator.appVersion.indexOf("Win") != -1) OSName = "Windows";
    else if (navigator.appVersion.indexOf("Mac") != -1) OSName = "MacOS";
    else if (navigator.appVersion.indexOf("X11") != -1) OSName = "UNIX";
    else if (navigator.appVersion.indexOf("Linux") != -1) OSName = "Linux";
    $("#hdnOSName").val(OSName);
    var ua = window.navigator.userAgent;
    if (ua.indexOf("Trident/7.0") > 0) {
        browserName = "MSIE";
    }
    else if (ua.indexOf("Edge") > -1) {
        browserName = "MSIE";
    }
    else if (ua.indexOf("Trident/6.0") > 0) {
        browserName = "MSIE";
    }
    else if (ua.indexOf("Trident/5.0") > 0) {
        browserName = "MSIE";
    }
    else if (ua.indexOf("Trident/4.0") > 0) {
        browserName = "MSIE";
    }
    else if (navigator.userAgent.toLowerCase().indexOf('chrome') > -1) {
        browserName = "Chrome";
    }
    else if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) {
        browserName = "Firefox";
    }


    $("#btnsignatureimagesign").hide();


    if ($("#hdnFileType").val() == "HASH" && $("hdnDocumentdetails").val() == null) {
        $("#divdata").hide();
    }
    else {
        $("#divedata").hide();
    }

});

$("#txtPassword").on('change keyup', function () {
    $('#txtpasswordCorrecterror').html('');
});

$("#btnSignBack").on('click', function () {
    //$('.option-list').fadeIn(500);
    $("#otpdetails").fadeOut(500);
    //$("#portSettingDiv").fadeIn(500);
    if (connection_final == null) {
        $("#divUtilityMsg").fadeIn(500);
    } else {
        $("#divUtilityMsg").fadeOut(500);
    }

    var SignatureMode = $("#hdnSigType").val();

    $("#signOption1").hide();
    $("#signOption2").hide();
    $("#signOption3").hide();
    $("#signOption4").hide();
    $("#signOption5").hide();
    $("#signOption6").hide();

    var divCount = 1;
    for (var sm = 0; sm < SignatureMode.length; sm++) {
        SignatureType = SignatureMode[sm];
        if (SignatureType == 1) {
            $("#signOption2").show();
            $("#portSettingDiv").show();
            if (SignatureMode.includes("2")) {
                $("#opt-divDsign").text(divCount + 1);
            }
            else {
                $("#opt-divDsign").text(divCount);
            }

            $("#signerContent_2").slideDown().addClass("open");
            if (connection_final == null) {
                SetConnectionPort(PortList);
            }
            divCount++;
        }
        else if (SignatureType == 2) {
            $("#signOption1").show();
            if (SignatureMode.includes("1")) {
                $("#opt-divesign").text(divCount - 1);
            }
            else {
                $("#opt-divesign").text(divCount);
            }
            $("#signerContent_1").slideDown().addClass("open");
            if ($("#hdnAadhaarNumber").val() != "") {
                var OriginalAdharNumer = $('#hdnAadhaarNumber').val();
                $("#txtAdhaarNumber").attr("disabled", true);
                var Last4digitofAadhaar = $('#hdnAadhaarNumber').val().substr(8, 11);
                $('#txtAdhaarNumber').val("XXXXXXXX" + Last4digitofAadhaar);
                $('#txtAdhaarNumber').attr("value", "XXXXXXXX" + Last4digitofAadhaar);
                $('#txtAdhaarNumber').attr("readonly", true);
            }
            else {
                $("#txtAdhaarNumber").val("");
            }
            if ($("#hdneSignAuthmode").val() == "3") {
                $("#divBiometric").show();
                $("#btnGetOtp").hide();
                $("#div-esignAuthRadio").hide();
                $("#otpdetails").slideUp();
            }
            divCount++;
        }
        else if (SignatureType == 3) {
            $("#signOption3").show();
            $("#opt-divesignature").text(divCount);
            divCount++;
        }
        else if (SignatureType == 4) {
            divCount++;
        }
        else if (SignatureType == 5) {
            divCount++;
        }
        else if (SignatureType == 6) {
            divCount++;
        }
        else if (SignatureType == 7) {
            $("#signOption5").show();
            $("#opt-divZsign").text(divCount);
            $("#portSettingDiv").show();
            divCount++;
        }
        else if (SignatureType == 8) {
            $("#signOption4").show();
            $("#opt-divVsign").text(divCount);
            $("#portSettingDiv").show();
            divCount++;
        }
    }
});


$("#signerLink_121").click(function () {
    if ($("#hdneSignAuthmode").val() == "2") {
        $("#btnGetOtp").show();
        if ($("#hdnAadhaarNumber").val() != "") {
            var OriginalAdharNumer = $('#hdnAadhaarNumber').val();
            $("#txtAdhaarNumber").attr("disabled", true);
            var Last4digitofAadhaar = $('#hdnAadhaarNumber').val().substr(8, 11);
            $('#txtAdhaarNumber').val("XXXXXXXX" + Last4digitofAadhaar);
            $('#txtAdhaarNumber').attr("value", "XXXXXXXX" + Last4digitofAadhaar);
            $('#txtAdhaarNumber').attr("readonly", true);
            $("#txtOTP").val("");
            $("#otpdetails").slideUp();

        }
        else {
            $("#txtAdhaarNumber").val("");
            $("#txtOTP").val("");
            $("#otpdetails").slideUp();
        }
    }
    else {
        if ($("#hdnAadhaarNumber").val() != "") {
            var OriginalAdharNumer = $('#hdnAadhaarNumber').val();
            $("#txtAdhaarNumber").attr("disabled", true);
            var Last4digitofAadhaar = $('#hdnAadhaarNumber').val().substr(8, 11);
            $('#txtAdhaarNumber').val("XXXXXXXX" + Last4digitofAadhaar);
            $('#txtAdhaarNumber').attr("value", "XXXXXXXX" + Last4digitofAadhaar);
            $('#txtAdhaarNumber').attr("readonly", true);
        }
        else {
            $("#txtAdhaarNumber").val("");
        }
        $("#btnGetOtp").hide();
        $("#otpdetails").slideUp();
    }

});

$("#txtPortNumber").keypress(function (e) {
    if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
        return false;
    }
});

$('#btnupdate').on("click", function () {
    var myport = $('#txtPortNumber').val();
    if (browserName == "Chrome" && myport == "65535") {
        $("#btnmsgcancel").hide();
        $('#msgcontent').attr('class', 'info');
        $('#msgcontent').html("Google Chrome is blocked this Port Number.");
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
        $('#txtPortNumber').val("1646");
        return false;
    }
    if (myport == "") {
        $("#btnmsgcancel").hide();
        $('#msgcontent').attr('class', 'info');
        $('#msgcontent').html("Please enter port number");
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
        $('#txtPortNumber').val("1646");
        return false;
    }
    if (parseInt(myport, 10) < parseInt("1025", 10) || parseInt(myport, 10) >= parseInt("65535", 10)) {
        $("#btnmsgcancel").hide();
        $('#msgcontent').attr('class', 'info');
        $('#msgcontent').html("Enter port number between 1025 to 65535");
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
        $('#txtPortNumber').val("1646");
        return false;
    }

    if (myport.match(/^\d{4}/)) {
    }
    else {

        $("#btnmsgcancel").hide();
        $('#msgcontent').attr('class', 'info');
        $('#msgcontent').html("Invalid port number");
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
        $('#txtPortNumber').val("1646");
        return false;
    }
    $.ajax({
        url: ChangePortNumberUrl,
        type: "POST",
        dataType: "json",
        data: { "PortNumber": $('#txtPortNumber').val(), __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
        success: function (data) {
            if (data.status == 1) {
                ChangeConnectionPort(myport);

                //window.location.reload();  

                //if (connection_final != null) {
                //    $("#Portsettings").modal('hide');
                //    $("#Portsettings").hide();
                //$("#divUtilityMsg").hide();                 
                //} else {
                //    $("#btndsign").hide();
                //}
            }
        },
        error: function (e) {
            $("#Portsettings").modal('hide');
            $("#Portsettings").hide();
            ShowHidePleaseWait('N');
            $("#btnmsgcancel").hide();
            $("#msgcontent").attr("class", "error");
            $('#msgcontent').html("Some error occured.Please try after sometime");
            $(".alertWindow").css({ 'display': "block" });
            $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
        }
    });
});
function SetConnectionPort(port) {
    if (port == "" || typeof port == "undefined" || port == null || port == 0) {
        port = 1646;
    }
    var connection = new WebSocket('wss://localhost.emudhra.com:' + port);
    connection.onopen = function () {
        $("#txtPortNumber").val(port);
        console.log('Connection Opened');
    };
    connection.onerror = function (error) {
        connection.close();
        SetConnectionPortWithIP(port);
        console.log('Connection closed');
    };
    connection.onmessage = function (e) {
        if (e.data.indexOf("subProtocol") == -1) {
            var signType = $("#hdnSigType").val();
            //if (signType == 1 || signType == 2 || signType == 5 || signType == 6 || signType == 8) {
            if (signType.includes("1") || signType.includes("2") || signType.includes("5") || signType.includes("6") || signType.includes("8")) {
                if (Utilityversion != e.data.substring(39, 42)) {
                    $("#divVersionMsg").show();
                    $('#txtPortNumber').val("1646");
                    $("#btndsign").attr('disabled');
                    $("#divUtilityMsg").hide();
                    $('#btndsign').addClass("btn btn-default");
                    $("#btnDsign").off("click");
                }
                else {
                    $("#divVersionMsg").hide();
                    $('#txtPortNumber').val("1646");
                    $("#btndsign").removeAttr('disabled');
                    $("#divUtilityMsg").hide();
                    $("#utilityTrue").show();
                    $('#btndsign').removeClass("btn btn-default");
                    $('#btndsign').addClass("btn btn-primary");
                    $("#btndsign").show();
                    $("#btnDsign").on('click');

                }
            }
            connection_final = connection;
            console.log('Connection finalized');
        }
    };
}
function SetConnectionPortWithIP(port) {
    if (port == "" || typeof port == "undefined" || port == null || port == 0) {
        port = 1646;
    }
    var connection = new WebSocket('wss://127.0.0.1:' + port);
    connection.onopen = function () {
        $("#addimage").show();
        $("#txtPortNumber").val(port);
        console.log('Connection Opened');
    };
    connection.onerror = function (error) {
        connection.close();
        var signType = $("#hdnSigType").val();
        //if (signType == 1 || signType == 2 || signType == 5 || signType == 6) {
        if (signType.includes("1") || signType.includes("2") || signType.includes("5") || signType.includes("6")) {
            $("#divUtilityMsg").show();
            $("#btnDsign").off('click');
        }
        console.log('Connection closed');
    };
    connection.onmessage = function (e) {
        if (e.data.indexOf("subProtocol") == -1) {
            var signType = $("#hdnSigType").val();
            //if (signType == 1 || signType == 2 || signType == 5 || signType == 6) {
            if (signType.includes("1") || signType.includes("2") || signType.includes("5") || signType.includes("6")) {
                if (Utilityversion != e.data.substring(39, 42)) {
                    $("#divVersionMsg").show();
                    $('#txtPortNumber').val("1646");
                    $("#btndsign").attr('disabled');
                    $("#divUtilityMsg").hide();
                    $('#btndsign').addClass("btn btn-default");
                    $("#btnDsign").off("click");
                }
                else {
                    $("#divVersionMsg").hide();
                    $('#txtPortNumber').val("1646");
                    $("#btndsign").removeAttr('disabled');
                    $("#divUtilityMsg").hide();
                    $("#utilityTrue").show();
                    $('#btndsign').removeClass("btn btn-default");
                    $('#btndsign').addClass("btn btn-primary");
                    $("#btndsign").show();
                    $("#btnDsign").on('click');

                }
            }
            connection_final = connection;
            console.log('Connection finalized');
        }
    };
}
function ChangeConnectionPort(port) {
    var connection;
    connection = new WebSocket('wss://localhost.emudhra.com:' + port);
    connection.onopen = function () {
        $("#txtPortNumber").val(port);
        console.log('Connection Opened');
        if (connection != null) {
            $("#Portsettings").modal('hide');
            $("#Portsettings").hide();
            $("#divUtilityMsg").hide();
        } else {
            $("#btnDsign").hide();
            $("#addimage").hide();
        }
        //connection_final = connection;
    };
    connection.onerror = function (error) {
        connection.close();
        ChangeConnectionPortWithIP(port);
        //console.log('Connection closed');
        $("#divUtilityMsg").hide();
        $("#btnDsign").hide();
        $("#addimage").hide();
        $("#Portsettings").modal('hide');
        $("#Portsettings").hide();
    };
    connection.onmessage = function (e) {

        if (e.data.indexOf("subProtocol") == -1) {
            var signType = $("#hdnSigType").val();
            //if (signType == 1 || signType == 2 || signType == 5 || signType == 6) {
            if (signType.includes("1") || signType.includes("2") || signType.includes("5") || signType.includes("6")) {
                if (VersionCheck != e.data.substring(39, 42)) {
                    $("#divVersionMsg").show();
                    $('#txtPortNumber').val("1646");
                    $("#btndsign").attr('disabled');
                    $('#btndsign').addClass("btn btn-default");
                    $("#btnDsign").off("click");
                }
                else {
                    $("#divVersionMsg").hide();
                    $('#txtPortNumber').val(port);
                    $("#utilityTrue").show();
                    $("#btndsign").removeAttr('disabled');
                    $('#btndsign').removeClass("btn btn-default");
                    $('#btndsign').addClass("btn btn-primary");
                    $("#btndsign").show();
                    $("#btnDsign").on('click');
                }
            }
            //connection_final = connection;
            console.log('Connection finalized');
        }

    };

}

function ChangeConnectionPortWithIP(port) {
    var connection;
    connection = new WebSocket('wss://127.0.0.1:' + port);
    connection.onopen = function () {
        $("#txtPortNumber").val(port);
        console.log('Connection Opened');
        $("#btnDsign").show();
        $("#btnDsign").on('click');
        $("#addimage").show();
        //$("#Portsettings").hide();
        $("#divUtilityMsg").hide();

    };
    connection.onerror = function (error) {
        connection.close();

        $('#txtPortNumber').val("1646");
        var signType = $("#hdnSigType").val();
        //if (signType == 1 || signType == 2 || signType == 5 || signType == 6) {
        if (signType.includes("1") || signType.includes("2") || signType.includes("5") || signType.includes("6")) {
            $("#divUtilityMsg").show();
            //$("#btnDsign").off('click');
        }
        $("#addimage").hide();
        $("#btnDsign").hide();
        $("#Portsettings").modal('hide');
        $("#Portsettings").hide();
        console.log('Connection closed');
    };
    connection.onmessage = function (e) {
        if (e.data.indexOf("subProtocol") == -1) {
            var signType = $("#hdnSigType").val();
            //if (signType == 1 || signType == 2 || signType == 5 || signType == 6) {
            if (signType.includes("1") || signType.includes("2") || signType.includes("5") || signType.includes("6")) {

                if (VersionCheck != e.data.substring(39, 42)) {
                    $("#divVersionMsg").show();
                    $('#txtPortNumber').val("1646");
                    $("#btndsign").attr('disabled');
                    $('#btndsign').addClass("btn btn-default");
                    //$("#btnDsign").off("click");
                }
                else {
                    $("#divVersionMsg").hide();
                    $('#txtPortNumber').val(port);
                    $("#utilityTrue").show();
                    $("#btndsign").removeAttr('disabled');
                    $('#btndsign').removeClass("btn btn-default");
                    $('#btndsign').addClass("btn btn-primary");
                    $("#btndsign").show();
                    $("#btnDsign").on('click');
                }
            }
            console.log('Connection finalized');
        }
    };
}

$('#helpmessageSource').click(function () {
    alertmessage();
});

$("#btnGetOtp").on("click", function () {
    ShowHidePleaseWait('Y');
    var checked = $('#chkdeclaration').prop('checked');
    if (!checked) {
        ShowHidePleaseWait('N');
        $("#btnmsgcancel").hide();
        $("#msgcontent").attr("class", "info");
        $('#msgcontent').html("Please agree to the consent.");
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr('onclick', "");
        $('#btnmsgok').text('Ok');
        $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
        return false;
    }
    if ($("#txtAdhaarNumber").val() == "") {
        ShowHidePleaseWait('N');
        $('#imgFollow').hide();
        $("#msgcontent").attr("class", "info");
        $('#msgcontent').html("Enter Aadhaar Number.");
        $("#btnmsgcancel").hide();
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
        return false;
    }
    else if ($("#txtAdhaarNumber").val().length < 12) {
        ShowHidePleaseWait('N');
        $('#imgFollow').hide();
        $("#msgcontent").attr("class", "info");
        $('#msgcontent').html("Enter 12 Digit Aadhaar Number.");
        $("#btnmsgcancel").hide();
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
        return false;
    }
    var AadhaarNumber
    if ($("#hdnAadhaarNumber").val() != "") {
        AadhaarNumber = $("#hdnAadhaarNumber").val();
    }
    else {
        AadhaarNumber = $("#txtAdhaarNumber").val();
    }
    $("#btnGetOtp").prop("disabled", true);
    ShowHidePleaseWait('Y');
    $.ajax({
        url: GETOTPURL,
        type: "POST",
        DataType: "json",
        data: { "AadharNumber": AadhaarNumber, __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
        success: function (data) {
            if (data.status == 1) {
                ShowHidePleaseWait('N');
                $("#btnGetOtp").attr("value", "Resend OTP");
                $("#txtAdhaarNumber").attr("disabled", true);
                $("#otpdetails").slideDown();
                $("#btnGetOtp").prop("disabled", false);
                $('#txtOTP').focus();
            }
            else if (data.status == 0) {
                ShowHidePleaseWait('N');
                $('#imgFollow').hide();
                $("#msgcontent").attr("class", "error");
                $('#msgcontent').html("Invalid Aadhaar number.");
                $("#btnmsgcancel").hide();
                $(".alertWindow").css({ 'display': "block" });
                if ($("#hdnAadhaarNumber").val() != "") {
                    var Last4digitofAadhaar = $('#hdnAadhaarNumber').val().substr(8, 11);
                    $('#txtAdhaarNumber').val("XXXXXXXX" + Last4digitofAadhaar);
                    $('#txtAdhaarNumber').attr("value", "XXXXXXXX" + Last4digitofAadhaar);
                    $('#txtAdhaarNumber').attr("readonly", true);
                    $("#btnGetOtp").text('Resend OTP').show();
                    $("#txtOTP").val("");
                    $("#btnGetOtp").prop("disabled", false);
                    $("#chkdeclaration").attr('checked', false);
                    $("#otpdetails").slideUp();
                    $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
                }
                else {
                    $("#txtAdhaarNumber").val("").focus();
                    $("#btnGetOtp").attr('value', 'Resend OTP');
                    $("#txtAdhaarNumber").attr("disabled", false);
                    $("#btnGetOtp").prop("disabled", false);
                    $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y',$('#txtAdhaarNumber').val('').focus());");
                }
            }
        },
        error: function (e) {
            ShowHidePleaseWait('N');
            $('#imgFollow').hide();
            $("#msgcontent").attr("class", "error");
            $('#msgcontent').html("Some error occured.Please try after sometime.");
            $("#btnmsgcancel").hide();
            $(".alertWindow").css({ 'display': "block" });
            $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
        }
    });
});

$("#btneSignature,#btnsignatureimagesign").on("click", function () {

    ShowHidePleaseWait('Y');
    var FileType = $("#hdnFileType").val();
    var IsCustomizeds = $("#IsCustomized").val();
    var IsCompressed = $("#hdnIsCompressed").val();
    if (FileType == "PDF") {
        var Pagelength = $("#hdnNoOfPages").val();
        var PageNumber = "";
        var SelectedValue;
        if (customselectPage == "true") {
            SelectedValue = $('#ddlPageSelection option:selected').val();
        }
        else {
            SelectedValue = $("#hdnSelectPage").val();
        }
        if (SelectedValue == "FIRST") {
            PageNumber = 1;
        }
        else if (SelectedValue == "ALL") {
            for (i = 0; i < parseInt(Pagelength); i++) {
                PageNumber += (i + 1) + ",";
            }
        }
        else if (SelectedValue == "EVEN") {
            for (i = 0; i < Pagelength; i++) {
                if (((i + 1) % 2) == 0) {
                    PageNumber += (i + 1) + ",";
                }
            }
        }
        else if (SelectedValue == "ODD") {
            for (i = 0; i < Pagelength; i++) {
                if (((i + 1) % 2) != 0) {
                    PageNumber += (i + 1) + ",";
                }
            }
        }
        else if (SelectedValue == "LAST") {
            PageNumber = Pagelength;
        }
        var docType = $("#hdnDocType").val();
        //Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
        if (IsCustomizeds == "True") {
            Coordinates = $("#hdnCoordinates").val();
            if (Coordinates == "") {
                Coordinates = $("#hdnCustomizecoordinates").val();
                if (Coordinates == "") {
                    Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
                }
            }
        }
        else {
            Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
        }
        if (SelectedValue == "SPECIFY") {
            PageNumber = $("#hdnPageNumber").val();
            //Coordinates = $("#hdnNewcoordinates").val();
        }
        else if (SelectedValue == "PAGE LEVEL") {
            PageNumber = $("#hdnPagelevelCordinates").val();
            Coordinates = $("#hdnPagelevelCordinates").val();
            //PageNumber = $("#hdnCoordinates").val()
        }

        var InitialsCoordinates = null;
        if ($("#EnableInitials").val() == "True") { InitialsCoordinates = GetInitialsCoordinatesforSigning(); }

        var DisplayName = $("#hdnName").val();
        var FileName = $("#hdnFileFullPath").val();
        var ImageData = "";
        if (SignatureImg == "" || SignatureImg == null) {
            if ($("#hdnSignatureImageOption").val() == 1) {
                ImageData = $("#SignatureImage").val();
            }
            else if ($("#hdnSignatureImageOption").val() == 2) {
                if ($("#signature").jSignature('getData', 'native') != 0) {
                    ImageData = $('#signature').jSignature('getData');
                }
                else {
                    ImageData = "";
                }
            }
            else if ($("#hdnSignatureImageOption").val() == 3) {
                ImageData = $('#hdnFilePath').val();
            }
            else if ($("#hdnSignatureImageOption").val() == 4) {
                ImageData = $("#hdntopozImagevalue").val();
                $('#hdnSignatureImagevisible').val(1);
            }
        } else {
            ImageData = SignatureImg;
        }
        if (ImageData == "") {
            ShowHidePleaseWait('N');
            $('#imgFollow').hide();
            $("#msgcontent").attr("class", "info");
            if (innertabLink == "innertabLink_1") {
                if ($("#SelectFontOption").val() == "True") {
                    $('#msgcontent').html("Please select any one font option.");
                }
            } else
                if (innertabLink == "innertabLink_2") {
                    if ($("#DrawSignatureOption").val() == "True") {
                        $('#msgcontent').html("Please Draw an image.");
                    }
                } else if (innertabLink == "innertabLink_3") {
                    if ($("#UploadSignatureOption").val() == "True") {
                        $('#msgcontent').html("Please upload an image with maximum of 200kb and minimum 100kb");
                    }
                } else if (innertabLink == "innertabLink_4") {
                    if ($("#eSignaturePadOption").val() == "True") {
                        $('#msgcontent').html("Please select Pad Option");
                    }
                }
            //$('#msgcontent').html("Please select any of the signature options");
            $("#btnmsgcancel").hide();
            $(".alertWindow").css({ 'display': "block" });
            $('#btnmsgok').html('OK');
            $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
            return false;
        }
        $.ajax({
            url: GETESIGHASHURL,
            type: "POST",
            DataType: "json",
            data: { "Page": SelectedValue, "PageNumber": PageNumber, "Coordinates": Coordinates, "DisplayName": DisplayName, "FileName": FileName, "SignatureImage": ImageData, "SignatureOption": $("#hdnSignatureImageOption").val(), "Authtoken": $("#hdnAuthToken").val(), "IsCompressed": IsCompressed, "InitialsCoordinates": InitialsCoordinates, __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
            success: function (data) {
                if (data.Value == "Success") {
                    ShowHidePleaseWait('N');
                    window.location.href = '/eMsecure/V3_0/SendSuccessResponse';
                }
                else if (data.Value == "Failure") {
                    if (data.status == -2) {
                        ShowHidePleaseWait('N');
                        $('#imgFollow').hide();
                        $("#msgcontent").attr("class", "error");
                        $('#msgcontent').html(data.Message);
                        $("#btnmsgcancel").hide();
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').click(function () { $(".alertWindow").hide(); $(".modal-backdrop").hide(); });
                        return false;
                    } else {
                        $("#Signaturedropdown").modal('hide');
                        ShowHidePleaseWait('N');
                        $('#imgFollow').hide();
                        $("#msgcontent").attr("class", "error");
                        $('#msgcontent').html(data.Message);
                        $("#btnmsgcancel").hide();
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
                    }
                }
                else if (data.Value == 1) {
                    ShowHidePleaseWait('N');
                    $('#imgFollow').hide();
                    $("#msgcontent").attr("class", "error");
                    $('#msgcontent').html(data.Message);
                    $("#btnmsgcancel").hide();
                    $(".alertWindow").css({ 'display': "block" });
                    $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
                }
            },
            error: function (e) {
                ShowHidePleaseWait('N');
                $('#imgFollow').hide();
                $("#msgcontent").attr("class", "error");
                $('#msgcontent').html("Some error occured.Please try after sometime");
                $("#btnmsgcancel").hide();
                $(".alertWindow").css({ 'display': "block" });
                $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
            }
        });
    }
    else {
        ShowHidePleaseWait('N');
        $('#imgFollow').hide();
        $("#msgcontent").attr("class", "info");
        $('#msgcontent').html("eSignature is not applicable for XML and Data signing.");
        $("#btnmsgcancel").hide();
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
    }
});


$("#signerLink_1").on("click", function () {
    ShowHidePleaseWait('Y');
    //$("#signerLink_1").attr("href", "#eSignAuthModel");
    //$("#signerLink_1").attr("data-toggle", "modal");
    var IsCompressed = $("#hdnIsCompressed").val();
    var Base64FileData = $("#hdnBase64FileData").val();
    var AuthToken = $("#hdnAuthToken").val();
    var Name = $("#hdnName").val();
    var FileType = $("#hdnFileType").val();
    var DocEdata = $("#hdnDocumentdetails").val();
    var DataHash = $("#hdnDataHash").val();
    var IsCustomizeds = $("#IsCustomized").val();
    if (FileType == "PDF") {
        var gReason = $("#hdReason").val();
        var gLocation = $("#hdLocation").val();
        var SelectedValue, selectedSignaturePosition;
        if (IsCustomizeds == "True") {
            SelectedValue = $('#ddlPageSelection option:selected').val();
            selectedSignaturePosition = $('#ddlSignaturePosition option:selected').val();
            if (SelectedValue == "SPECIFY") {
                if ($('#txtPageNumber').val() == "") {
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html("Enter Pageno");
                    $(".alertWindow").css({ 'display': "block" });
                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                    ShowHidePleaseWait('N');
                    return false;
                }
                if ($('#txtPageNumber').val() != "") {
                    var length = Specifyval;
                    if (length == 0) {
                        $("#btnmsgcancel").hide();
                        $("#msgcontent").attr("class", "info");
                        $('#msgcontent').html("Please click on apply button to save page settings");
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                        ShowHidePleaseWait('N');
                        return false;
                    }
                }
                var csvPageNumbers = $('#hdnPageNumber').val().split(',');
                if (csvPageNumbers == "") {
                    //$('#btnmsgok').removeAttr('onClick');
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html("Please click on apply button to save page settings");
                    $(".alertWindow").css({ 'display': "block" });
                    //$('#btnmsgok').attr('onclick', "");
                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                    ShowHidePleaseWait('N');
                    return false;
                }
            }
            if (SelectedValue == "PAGE LEVEL") {
                var currentId = 1;
                var signatorylength = $(".Signatory" + currentId).length;
                var config = "";
                for (i = 1; i <= signatorylength; i++) {
                    var Page = $('#fieldPagination_' + i + ' option:selected').val();
                    var id1 = $('#draggableDiv_' + currentId + '_' + i)[0];
                    var Width = id1.offsetWidth;
                    var Height = id1.offsetHeight;
                    var Left = id1.offsetLeft;
                    var Top = id1.offsetTop;
                    Top = $('.documentVisual img').height() - Top;
                    Height = (Number(Top) - Number(Height));
                    Width = (Number(Left) + Number(Width));
                    config += Page + ',' + Left + ',' + Top + ',' + Width + ',' + Height + ';';

                    Coordinates = Page + ',' + Left + ',' + Top + ',' + Width + ',' + Height;
                    updCord = "true";
                    customselectPage = "true";
                }
                config = config.substring(0, config.length - 1);
                var pageNumbers = config;
                $("#hdnPagelevelCordinates").val(pageNumbers);
                $("#hdnCoordinates").val(pageNumbers);
            }
        }
    }


    if (FileType == "PDF") {
        var Pagelength = $("#hdnNoOfPages").val();
        var PageNumber = "";
        var SelectedValue;
        if (customselectPage == "true") {
            SelectedValue = $('#ddlPageSelection option:selected').val();
            //SignPosition = $('#ddlSignaturePosition option:selected').val()
        }
        else {
            SelectedValue = $("#hdnSelectPage").val();
        }

        var selectedSignaturePosition = $('#hdnSigPosition').val();
        Validatecoordinate();
        var Coordinates = "";

        if (SelectedValue == "FIRST") {
            PageNumber = 1;
        }
        else if (SelectedValue == "ALL") {
            for (i = 0; i < parseInt(Pagelength); i++) {
                PageNumber += (i + 1) + ",";
            }
        }
        else if (SelectedValue == "EVEN") {
            for (i = 0; i < Pagelength; i++) {
                if (((i + 1) % 2) == 0) {
                    PageNumber += (i + 1) + ",";
                }
            }
        }
        else if (SelectedValue == "ODD") {
            for (i = 0; i < Pagelength; i++) {
                if (((i + 1) % 2) != 0) {
                    PageNumber += (i + 1) + ",";
                }
            }
        }
        else if (SelectedValue == "LAST") {
            PageNumber = Pagelength;
        }
        var docType = $("#hdnDocType").val();
        //Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
        if (IsCustomizeds == "True") {
            Coordinates = $("#hdnCoordinates").val();
            if (Coordinates == "") {
                Coordinates = $("#hdnCustomizecoordinates").val();
                if (Coordinates == "") {
                    Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
                }
            }
        }
        else {
            Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);

        }

        var InitialsCoordinates = null;
        if ($("#EnableInitials").val() == "True") { InitialsCoordinates = GetInitialsCoordinatesforSigning(); }
        if (SelectedValue == "SPECIFY") {
            PageNumber = $("#hdnPageNumber").val();
            //Coordinates = $("#hdnNewcoordinates").val();
        }
        else if (SelectedValue == "PAGE LEVEL") {
            PageNumber = $("#hdnPagelevelCordinates").val();
            Coordinates = $("#hdnPagelevelCordinates").val();
        }
        var Location = $("#txtLocation").val();
        var Reason = $("#txtReason").val();
        var DisplayName = $("#hdnName").val();
        var FileName = $("#hdnFileFullPath").val();
        var ImageData = "";
        if ($("#hdnSignatureImageOption").val() == 1) {
            ImageData = $("#SignatureImage").val();
        }
        else if ($("#hdnSignatureImageOption").val() == 2) {
            if ($("#signature").jSignature('getData', 'native') != 0) {
                ImageData = $('#signature').jSignature('getData');
            }
            else {
                ImageData = "";
            }
        }
        else if ($("#hdnSignatureImageOption").val() == 3) {
            ImageData = $('#hdnFilePath').val();
        }
        else if ($("#hdnSignatureImageOption").val() == 4) {
            ImageData = $("#hdntopozImagevalue").val();
            $('#hdnSignatureImagevisible').val(1);
        }
        $.ajax({
            url: eSignURL,
            type: "POST",
            dataType: "json",
            data: { "Coordinates": Coordinates, "Page": SelectedValue, "PageNumber": PageNumber, "FileName": FileName, "AuthToken": AuthToken, "SignatureImage": ImageData, "SignatureOption": $("#hdnSignatureImageOption").val(), "Name": $("#hdnName").val(), "Cosign": $("#IsCosign").val(), "IsCompressed": IsCompressed, "Reason": gReason, "Location": gLocation, "InitialsCoordinates": InitialsCoordinates, __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
            success: function (data) {
                if (data.Value == "success") {
                    ShowHidePleaseWait('N');
                    if (data.GatewayUrl == "") {
                        //$('#eSignGatewayframe').attr("src", eAuthURL + "?txnref=" + data.Redirect);
                        $(location).attr('href', eAuthURL + "?txnref=" + data.Redirect);
                    }
                    else {
                        //$('#eSignGatewayframe').attr("src", data.GatewayUrl + "?txnref=" + data.Redirect);
                        $(location).attr('href', data.GatewayUrl + "?txnref=" + data.Redirect);
                    }
                    return false;
                }
                else if (data.Value == "Failure") {
                    if (data.status == -2) {
                        ShowHidePleaseWait('N');
                        $('#imgFollow').hide();
                        $("#msgcontent").attr("class", "error");
                        $('#msgcontent').html(data.Message);
                        $("#btnmsgcancel").hide();
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').click(function () { $(".alertWindow").hide(); $(".modal-backdrop").hide(); });
                        $("#eSignAuthModel").css({ 'display': "none" });
                        return false;
                    } else {
                        ShowHidePleaseWait('N');
                        $("#msgcontent").attr("class", "error");
                        $('#msgcontent').html(data.Message);
                        $("#btnmsgcancel").hide();
                        //$(".alertWindow").css({ 'display': "block" });
                        $(".alertWindow").show();
                        //$('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                        $('#btnmsgok').click(function () {
                            $(".alertWindow").hide();
                            $(".modal-backdrop").hide();
                            $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
                        });
                        $("#eSignAuthModel").css({ 'display': "none" });
                        return false;
                    }



                    //$('#imgFollow').hide();
                    //$("#msgcontent").attr("class", "error");
                    //if (data.Message == "Root element is missing.") {
                    //    $('#msgcontent').html("Unable to connect. Please retry.");
                    //}
                    //else if (data.Message == "PdfReader not opened with owner password") {
                    //    $('#msgcontent').html("The uploaded PDF file is restricted from signing.");
                    //    $(".alertWindow").css({ 'display': "block" });
                    //    $('#btnmsgok').attr('onclick', "javascript:RedirectError();");
                    //    return false;
                    //}
                    //else {
                    //    $('#msgcontent').html(data.Message);
                    //}
                    //$("#btnmsgcancel").hide();
                    //$(".alertWindow").css({ 'display': "block" });
                    //if (check_value != "Biometric") {
                    //    $("#otpdetails").slideDown();
                    //    $("#txtOTP").val("").focus();
                    //    if (data.Message == "PdfReader not opened with owner password") {

                    //        $(".alertWindow").css({ 'display': "block" });
                    //        $('#btnmsgok').attr('onclick', "javascript:RedirectError();");
                    //        return false;
                    //    } else {
                    //        $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
                    //    }

                    //}
                    //else {
                    //    $("#hdnResponse").val('');
                    //    if (data.Message == "PdfReader not opened with owner password") {

                    //        $(".alertWindow").css({ 'display': "block" });
                    //        $('#btnmsgok').attr('onclick', "javascript:RedirectError();");
                    //        return false;
                    //    } else {
                    //        $('#btnmsgok').attr('onclick', "javascript:ApplyImage();");
                    //    }
                    //    $("#otpdetails").slideUp();
                    //    $("#btnBioSign").hide();
                    //}
                    //$("#divadr").show();

                    //return false;
                }
                else if (data.Value == 1) {
                    ShowHidePleaseWait('N');
                    $('#imgFollow').hide();
                    $("#msgcontent").attr("class", "error");
                    if (data.Message == "Root element is missing.") {
                        $('#msgcontent').html("Unable to connect. Please retry.");
                    }
                    else if (data.Message == "PdfReader not opened with owner password") {
                        $('#msgcontent').html("The uploaded PDF file is restricted from signing.");
                    }
                    else {
                        $('#msgcontent').html(data.Message);
                    }
                    $("#btnmsgcancel").hide();
                    $(".alertWindow").css({ 'display': "block" });

                    $("#hdnResponse").val('');
                    if (data.Message == "PdfReader not opened with owner password") {
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').attr('onclick', "javascript:RedirectError();");
                        return false;
                    } else {
                        $('#btnmsgok').attr('onclick', "javascript:ApplyImage();");
                    }



                    return false;
                }
            },
            error: function (e) {
                ShowHidePleaseWait('N');
                $('#imgFollow').hide();
                $("#msgcontent").attr("class", "error");
                $('#msgcontent').html("Some error occured.Please try after sometime.");
                $("#btnmsgcancel").hide();
                $(".alertWindow").css({ 'display': "block" });
                $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
            }
        });
    }

    else if (FileType == "XML") {
        ShowHidePleaseWait('N');
        $('#imgFollow').hide();
        $("#msgcontent").attr("class", "info");
        $('#msgcontent').html("eSign is not applicable for XML and Data signing.");
        $("#btnmsgcancel").hide();
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
        return false;
    }
    else if (FileType == "DATA") {
        ShowHidePleaseWait('N');
        $('#imgFollow').hide();
        $("#msgcontent").attr("class", "info");
        $('#msgcontent').html("eSign is not applicable for XML and Data signing.");
        $("#btnmsgcancel").hide();
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
        return false;
    }
    else if (FileType == "XML") {
        var IsCompressed = $("#hdnIsCompressed").val();
        $.ajax({
            url: XMLeSignURL,
            type: "POST",
            dataType: "json",
            data: { "Data": Base64FileData, "AuthToken": AuthToken, "IsCompressed": IsCompressed, __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
            success: function (data) {
                if (data.Value == "success") {
                    ShowHidePleaseWait('N');
                    //$('#eSignGatewayframe').attr("src", eAuthURL + "?txnref=" + data.Redirect);
                    $(location).attr('href', eAuthURL + "?txnref=" + data.Redirect);
                    return false;
                }
                else if (data.Value == "Failure") {
                    if (data.status == -2) {
                        ShowHidePleaseWait('N');
                        $('#imgFollow').hide();
                        $("#msgcontent").attr("class", "error");
                        $('#msgcontent').html(data.Message);
                        $("#btnmsgcancel").hide();
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').click(function () { $(".alertWindow").hide(); $(".modal-backdrop").hide(); });
                        $("#eSignAuthModel").css({ 'display': "none" });
                        return false;
                    } else {
                        ShowHidePleaseWait('N');
                        $('#imgFollow').hide();
                        $("#msgcontent").attr("class", "error");
                        $('#msgcontent').html(data.Message);
                        $("#btnmsgcancel").hide();
                        $(".alertWindow").css({ 'display': "block" });
                        if (check_value != "Biometric") {
                            $("#otpdetails").show();
                            $("#txtOTP").val("").focus();
                            $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
                        }
                        else {
                            $("#hdnResponse").val('');
                            $('#btnmsgok').attr('onclick', "javascript:ApplyImage();");
                            $("#otpdetails").hide();
                            $("#btnBioSign").hide();
                        }
                        $("#divadr").show();
                        return false;
                    }
                }
                else if (data.Value == 1) {
                    ShowHidePleaseWait('N');
                    $('#imgFollow').hide();
                    $("#msgcontent").attr("class", "error");
                    $('#msgcontent').html(data.Message);
                    $("#btnmsgcancel").hide();
                    $(".alertWindow").css({ 'display': "block" });
                    if (check_value != "Biometric") {
                        $("#otpdetails").show();
                        $("#txtOTP").val("").focus();
                        $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
                    }
                    else {
                        $("#hdnResponse").val('');
                        $('#btnmsgok').attr('onclick', "javascript:ApplyImage();");
                        $("#otpdetails").hide();
                        $("#btnBioSign").hide();
                    }
                    $("#divadr").show();
                    return false;
                }
            },
            error: function (e) {
                ShowHidePleaseWait('N');
                $('#imgFollow').hide();
                $("#msgcontent").attr("class", "error");
                $('#msgcontent').html("Some error occured.Please try after sometime.");
                $("#btnmsgcancel").hide();
                $(".alertWindow").css({ 'display': "block" });
                $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
                return false;
            }
        });
    }
    else if ((DocEdata != "") && (FileType == "HASH")) {
        //else if ($("#hdnDocURL").display != 'none') {
        var IsCompressed = $("#hdnIsCompressed").val();
        $.ajax({
            url: BulkhashSigningWithEsignURL,
            type: "POST",
            dataType: "json",
            // data: { "OTP": OTP, "AadharNumber": AadhaarNumber, "Data": Base64FileData, "AuthToken": AuthToken, "IsCompressed": IsCompressed, "Mode": Mode },
            data: { "Data": DocEdata, __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
            success: function (data) {
                if (data.Value == "success") {
                    ShowHidePleaseWait('N');
                    //$('#eSignGatewayframe').attr("src", eAuthURL + "?txnref=" + data.Redirect);
                    $(location).attr('href', eAuthURL + "?txnref=" + data.Redirect);
                    return false;
                }
                else if (data.Value == "Failure") {
                    if (data.status == -2) {
                        ShowHidePleaseWait('N');
                        $('#imgFollow').hide();
                        $("#msgcontent").attr("class", "error");
                        $('#msgcontent').html(data.Message);
                        $("#btnmsgcancel").hide();
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').click(function () { $(".alertWindow").hide(); $(".modal-backdrop").hide(); });
                        $("#eSignAuthModel").css({ 'display': "none" });
                        return false;
                    } else {
                        ShowHidePleaseWait('N');
                        $('#imgFollow').hide();
                        $("#msgcontent").attr("class", "error");
                        $('#msgcontent').html(data.Message);
                        $("#btnmsgcancel").hide();
                        $(".alertWindow").css({ 'display': "block" });
                        //if (check_value != "Biometric") {
                        //    //$("#otpdetails").show();
                        //    //$("#txtOTP").val("").focus();
                        //    $(".modal-backdrop").hide();
                        //    $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
                        //}
                        //else {
                        //    $("#hdnResponse").val('');
                        //    $('#btnmsgok').attr('onclick', "javascript:ApplyImage();");
                        //    $("#otpdetails").hide();
                        //    $("#btnBioSign").hide();
                        //}
                        $("#divadr").show();
                        $("#hdnResponse").val('');
                        $("#otpdetails").hide();
                        $("#btnBioSign").hide();
                        $(".modal-backdrop").hide();
                        $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
                        $("#eSignAuthModel").css({ 'display': "none" });
                        return false;
                    }
                }
                else if (data.Value == 1) {
                    ShowHidePleaseWait('N');
                    $('#imgFollow').hide();
                    $("#msgcontent").attr("class", "error");
                    $('#msgcontent').html(data.Message);
                    $("#btnmsgcancel").hide();
                    $(".alertWindow").css({ 'display': "block" });
                    //if (check_value != "Biometric") {
                    //    $("#otpdetails").show();
                    //    $("#txtOTP").val("").focus();
                    //    $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
                    //}
                    //else {
                    //    $("#hdnResponse").val('');
                    //    $('#btnmsgok').attr('onclick', "javascript:ApplyImage();");
                    //    $("#otpdetails").hide();
                    //    $("#btnBioSign").hide();
                    //}
                    $("#divadr").show();
                    $("#hdnResponse").val('');
                    $("#otpdetails").hide();
                    $("#btnBioSign").hide();
                    $(".modal-backdrop").hide();
                    $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
                    $("#eSignAuthModel").css({ 'display': "none" });
                    return false;
                }
            },
            error: function (e) {
                ShowHidePleaseWait('N');
                $('#imgFollow').hide();
                $("#msgcontent").attr("class", "error");
                $('#msgcontent').html("Some error occured.Please try after sometime.");
                $("#btnmsgcancel").hide();
                $(".alertWindow").css({ 'display': "block" });
                $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse?ErrorMessage=' + "Some error occured.Please try after sometime.");
            }
        });
    }

    else {
        var IsCompressed = $("#hdnIsCompressed").val();
        $.ajax({
            url: DATAeSignURL,
            type: "POST",
            dataType: "json",
            //data: { "OTP": OTP, "AadharNumber": AadhaarNumber, "Data": Base64FileData, "AuthToken": AuthToken, "IsCompressed": IsCompressed, "Mode": Mode },
            data: { "Data": Base64FileData, "AuthToken": AuthToken, "IsCompressed": IsCompressed, __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
            success: function (data) {
                if (data.Value == "success") {
                    ShowHidePleaseWait('N');
                    //$('#eSignGatewayframe').attr("src", eAuthURL + "?txnref=" + data.Redirect);
                    $(location).attr('href', eAuthURL + "?txnref=" + data.Redirect);
                    return false;
                }
                else if (data.Value == "Failure") {
                    if (data.status == -2) {
                        ShowHidePleaseWait('N');
                        $('#imgFollow').hide();
                        $("#msgcontent").attr("class", "error");
                        $('#msgcontent').html(data.Message);
                        $("#btnmsgcancel").hide();
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').click(function () { $(".alertWindow").hide(); $(".modal-backdrop").hide(); });
                        $("#eSignAuthModel").css({ 'display': "none" });
                        return false;
                    } else {
                        ShowHidePleaseWait('N');
                        $('#imgFollow').hide();
                        $("#msgcontent").attr("class", "error");
                        $('#msgcontent').html(data.Message);
                        $("#btnmsgcancel").hide();
                        $(".alertWindow").css({ 'display': "block" });
                        if (check_value != "Biometric") {
                            $("#otpdetails").show();
                            $("#txtOTP").val("").focus();
                            $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
                        }
                        else {
                            $("#hdnResponse").val('');
                            $('#btnmsgok').attr('onclick', "javascript:ApplyImage();");
                            $("#otpdetails").hide();
                            $("#btnBioSign").hide();
                        }
                        $("#divadr").show();
                        return false;
                    }
                }
                else if (data.Value == 1) {
                    ShowHidePleaseWait('N');
                    $('#imgFollow').hide();
                    $("#msgcontent").attr("class", "error");
                    $('#msgcontent').html(data.Message);
                    $("#btnmsgcancel").hide();
                    $(".alertWindow").css({ 'display': "block" });
                    if (check_value != "Biometric") {
                        $("#otpdetails").show();
                        $("#txtOTP").val("").focus();
                        $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
                    }
                    else {
                        $("#hdnResponse").val('');
                        $('#btnmsgok').attr('onclick', "javascript:ApplyImage();");
                        $("#otpdetails").hide();
                        $("#btnBioSign").hide();
                    }
                    $("#divadr").show();
                    return false;
                }
            },
            error: function (e) {
                ShowHidePleaseWait('N');
                $('#imgFollow').hide();
                $("#msgcontent").attr("class", "error");
                $('#msgcontent').html("Some error occured.Please try after sometime.");
                $("#btnmsgcancel").hide();
                $(".alertWindow").css({ 'display': "block" });
                $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse?ErrorMessage=' + "Some error occured.Please try after sometime.");
            }
        });
    }
});

function RedirectError() {
    window.location = '/eMsecure/V3_0/SendErrorResponse';
    $('.alertWindow, .utilityWindow').hide();
}
function GetCoordinates(selectedSignaturePosition, docType) {

    var Coordinates = "";
    var actualPageHeight = 0;
    var IsDocWidth = $("#hdnRectWidth").val();
    var IsDocLeft = 0;
    if ($('.documentVisual img').length == 0) {
        prHeight = $("#hdnRectHeight").val();
        actualPageHeight = $("#hdnRectHeight").val();;
    }
    else {
        prHeight = $('.documentVisual img').height();
        actualPageHeight = $('.documentVisual img')[0].offsetHeight;
        }
    switch (selectedSignaturePosition) {
        case "Top-Left":
            $('#txtLeft').attr('disabled', true);
            Left = defaultLeftPxValue; TopDetails = actualPageHeight - defaultTopPxValue; Height = 60; Width = 120;
            Top = prHeight - TopDetails;
            return Coordinates = Left + "," + TopDetails + "," + (parseInt(Left) + parseInt(Width)) + "," + (parseInt(TopDetails) - parseInt(Height));
            break;
        case "Top-Center":
            if ($('.documentVisual img').length == 0) {
                Left = (((IsDocWidth / 2) - (defaultWidthPxValue / 2)) + defaultLeftPxValue) + IsDocLeft;
            }
            else {
                Left = ((($('.documentVisual img')[0].offsetWidth / 2) - (defaultWidthPxValue / 2)) + defaultLeftPxValue) + $('.documentVisual img')[0].offsetLeft;
            }
            TopDetails = actualPageHeight - defaultTopPxValue; Height = 60; Width = 120;
            Top = prHeight - TopDetails;
            return Coordinates = Left + "," + TopDetails + "," + (parseInt(Left) + parseInt(Width)) + "," + (parseInt(TopDetails) - parseInt(Height));
            break;

        case "Top-Right":
            if ($('.documentVisual img').length == 0) {
                Left = ((IsDocWidth - defaultWidthPxValue) - defaultLeftPxValue) - IsDocLeft;
            }
            else {
                Left = (($('.documentVisual img')[0].offsetWidth - defaultWidthPxValue) - defaultLeftPxValue) - $('.documentVisual img')[0].offsetLeft;
            }
            TopDetails = actualPageHeight - defaultTopPxValue; Height = 60; Width = 120;
            Top = prHeight - TopDetails;
            return Coordinates = Left + "," + TopDetails + "," + (parseInt(Left) + parseInt(Width)) + "," + (parseInt(TopDetails) - parseInt(Height));
            break;
        case "Middle-Left":
            Left = defaultLeftPxValue; TopDetails = (Number(prHeight) + defaultHeightPxValue) / 2; Height = 60; Width = 120;
            Top = prHeight - TopDetails;
            return Coordinates = Left + "," + TopDetails + "," + (parseInt(Left) + parseInt(Width)) + "," + (parseInt(TopDetails) - parseInt(Height));
            break;
        case "Middle-Center":
            if ($('.documentVisual img').length == 0) {
                Left = (((IsDocWidth / 2) - (defaultWidthPxValue / 2)) + defaultLeftPxValue) + IsDocLeft;
            }
            else {
                Left = ((($('.documentVisual img')[0].offsetWidth / 2) - (defaultWidthPxValue / 2)) + defaultLeftPxValue) + $('.documentVisual img')[0].offsetLeft;
            }
            TopDetails = (Number(prHeight) + defaultHeightPxValue) / 2;
            Height = 60; Width = 120;
            Top = prHeight - TopDetails;
            return Coordinates = Left + "," + TopDetails + "," + (parseInt(Left) + parseInt(Width)) + "," + (parseInt(TopDetails) - parseInt(Height));
            break;
        case "Middle-Right":
            if ($('.documentVisual img').length == 0) {
                Left = ((IsDocWidth - defaultWidthPxValue) - defaultLeftPxValue) - IsDocLeft;
            }
            else {
                Left = (($('.documentVisual img')[0].offsetWidth - defaultWidthPxValue) - defaultLeftPxValue) - $('.documentVisual img')[0].offsetLeft;
            }
            TopDetails = (Number(prHeight) + defaultHeightPxValue) / 2;
            Height = 60; Width = 120;
            Top = prHeight - TopDetails;
            return Coordinates = Left + "," + TopDetails + "," + (parseInt(Left) + parseInt(Width)) + "," + (parseInt(TopDetails) - parseInt(Height));
            break;
        case "Bottom-Left":
            Left = defaultLeftPxValue;
            TopDetails = defaultHeightPxValue + defaultBottomPxValue;
            Height = 60; Width = 120;
            Top = prHeight - TopDetails;
            return Coordinates = Left + "," + TopDetails + "," + (parseInt(Left) + parseInt(Width)) + "," + (parseInt(TopDetails) - parseInt(Height));
            break;
        case "Bottom-Center":
            if ($('.documentVisual img').length == 0) {
                Left = (((IsDocWidth / 2) - (defaultWidthPxValue / 2)) + defaultLeftPxValue) + IsDocLeft;
            }
            else {
                Left = ((($('.documentVisual img')[0].offsetWidth / 2) - (defaultWidthPxValue / 2)) + defaultLeftPxValue) + $('.documentVisual img')[0].offsetLeft;
            }
            TopDetails = defaultHeightPxValue + defaultBottomPxValue;
            Height = 60; Width = 120;
            Top = prHeight - TopDetails;
            return Coordinates = Left + "," + TopDetails + "," + (parseInt(Left) + parseInt(Width)) + "," + (parseInt(TopDetails) - parseInt(Height));
            break;
        case "Bottom-Right":
            if ($('.documentVisual img').length == 0) {
                Left = ((IsDocWidth - defaultWidthPxValue) - defaultLeftPxValue) - IsDocLeft;
            }
            else {
                Left = (($('.documentVisual img')[0].offsetWidth - defaultWidthPxValue) - defaultLeftPxValue) - $('.documentVisual img')[0].offsetLeft;
            }
            TopDetails = defaultHeightPxValue + defaultBottomPxValue;
            Height = 60; Width = 120;
            Top = prHeight - TopDetails;
            return Coordinates = Left + "," + TopDetails + "," + (parseInt(Left) + parseInt(Width)) + "," + (parseInt(TopDetails) - parseInt(Height));
            break;
        default:
            return Coordinates = $("#hdnCustomizecoordinates").val();
            break;
    }
}
function UpdateCoordinates(divBox) {
    var Coordinates = "";
    var id = divBox.id.replace('dragDiv', '');
    var currentId = id.split('_')[0];
    var TopDetails = docType == "Portrait" ? 839 : 590;
    var Width = parseInt(divBox.offsetWidth);
    var Height = parseInt(divBox.offsetHeight);
    var Left = divBox.offsetLeft;
    var Top = divBox.offsetTop;

    Top = $('.documentVisual img').height() - Top;

    //$('.Signatory' + 1 + '').attr("style", "left: " + Left + "px; top:" + Top + "px; width: " + Width + "px; height:" + Height + "px; position: absolute;");
    //Coordinates = Left + "," + TopDetails + "," + (parseInt(Left) + parseInt(Width)) + "," + (parseInt(TopDetails) - parseInt(Height));
    Coordinates = Left + ',' + Top + ',' + Width + ',' + Height;
    $("#hdnCoordinates").val(Coordinates);

}
$("#btnEsignReset").on("click", function () {
    $("#txtOTP").val("");
    $("#txtReason").val("");
    $("txtLocation").val("");
    $("#txtAdhaarNumber").val("");
    $("#otpdetails").slideDown();
});


$("#btnSignatureApply").on('click', function () {
    $('#signature canvas').remove();
    dsignsignatureValidation = true;
    var FileType = $("#hdnFileType").val();
    if (FileType == "PDF") {
        var SelectedValue, selectedSignaturePosition, Page;
        var IsCustomizeds = $("#IsCustomized").val();
        if (IsCustomizeds == "True") {
            SelectedValue = $('#ddlPageSelection option:selected').val();
            selectedSignaturePosition = $('#ddlSignaturePosition option:selected').val();
            Page = $('#ddlPageSelection option:selected').val();
            if (SelectedValue == "SPECIFY") {
                if ($('#txtPageNumber').val() == "") {
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html("Enter Pageno");
                    $(".alertWindow").css({ 'display': "block" });
                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                    ShowHidePleaseWait('N');
                    return false;
                }
                if ($('#txtPageNumber').val() != "") {
                    var length = Specifyval;
                    if (length == 0) {
                        $("#btnmsgcancel").hide();
                        $("#msgcontent").attr("class", "info");
                        $('#msgcontent').html("Please click on apply button to save page settings");
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                        ShowHidePleaseWait('N');
                        return false;
                    }
                }
                var csvPageNumbers = $('#hdnPageNumber').val().split(',');
                if (csvPageNumbers == "") {
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html("Please click on apply button to save page settings");
                    $(".alertWindow").css({ 'display': "block" });
                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                    ShowHidePleaseWait('N');
                    return false;
                }
            }
            if (SelectedValue == "PAGE LEVEL") {
                var currentId = 1;
                var signatorylength = $(".Signatory" + currentId).length;
                var config = "";
                for (i = 1; i <= signatorylength; i++) {
                    var Page1 = $('#fieldPagination_' + i + ' option:selected').val();
                    var id1 = $('#draggableDiv_' + currentId + '_' + i)[0];
                    var Width = id1.offsetWidth;
                    var Height = id1.offsetHeight;
                    var Left = id1.offsetLeft;
                    var Top = id1.offsetTop;
                    Top = $('.documentVisual img').height() - Top;
                    Height = (Number(Top) - Number(Height));
                    Width = (Number(Left) + Number(Width));
                    config += Page1 + ',' + Left + ',' + Top + ',' + Width + ',' + Height + ';';

                    Coordinates = Page1 + ',' + Left + ',' + Top + ',' + Width + ',' + Height;
                    updCord = "true";
                    customselectPage = "true";
                }
                config = config.substring(0, config.length - 1);
                var pageNumbers = config;
                $("#hdnPagelevelCordinates").val(pageNumbers);
                $("#hdnCoordinates").val(pageNumbers);
            }
        }
        else {
            SelectedValue = $('#hdnSelectPage').val();
            selectedSignaturePosition = $('#hdnSigPosition').val();
            Page = $("#hdnSelectPage").val();
        }
        Validatecoordinate()
        $('#btnDigitalsign').show();
        $("#btneSignature").hide();
        $("#btnSignatureApply").attr("href", "#Signaturedropdown");
        $("#btnSignatureApply").attr("data-toggle", "modal");
        $("#txtFullName").val(DisplayName);
        $(".font-sign").text(DisplayName);
        $('input[name="backimg"]').attr('checked', false);
        $("#Signaturedropdown .sign-font-option li").removeClass("selected");
        $("#txtsignatureimage").val('');
        $("#lblerrormessage").text("");
        $('#SignatureImage').val("");
        $('#hdnFilePath').val("");
        $("#hdnSignatureImageOption").val("");
        if ($("#SelectFontOption").val() == "False") {
            //$("#innertabLink_1").removeClass('active');
            //$("#innertabContent_1").hide();
            if ($("#DrawSignatureOption").val() == "True") {
                $("#innertabLink_2").addClass('active');
                $("#innertabContent_2").show();
                $("#innertabLink_1").removeClass('active');
                $("#innertabLink_3").removeClass('active');
                $("#innertabLink_4").removeClass('active');
                $("#innertabContent_1").hide();
                $("#innertabContent_3").hide();
                $("#innertabContent_4").hide();
                $("#hdnSignatureImageOption").val(2);
                $("#signature").jSignature({
                    'background-color': 'transparent',
                    'decor-color': 'transparent',
                    'lineWidth': 5,
                    'height': 204
                });

            }
            else if ($("#UploadSignatureOption").val() == "True") {
                $("#innertabLink_3").addClass('active');
                $("#innertabContent_3").show();
                $("#innertabLink_1").removeClass('active');
                $("#innertabLink_2").removeClass('active');
                $("#innertabLink_4").removeClass('active');
                $("#innertabContent_1").hide();
                $("#innertabContent_2").hide();
                $("#innertabContent_4").hide();
            }
            else {
                $("#innertabLink_4").addClass('active');
                $("#innertabContent_4").show();
                $("#innertabLink_1").removeClass('active');
                $("#innertabLink_2").removeClass('active');
                $("#innertabLink_3").removeClass('active');
                $("#innertabContent_1").hide();
                $("#innertabContent_2").hide();
                $("#innertabContent_3").hide();
            }

        }
        else {
            $("#innertabLink_1").addClass('active');
            $("#innertabContent_1").show();
            $("#innertabLink_2").removeClass('active');
            $("#innertabLink_3").removeClass('active');
            $("#innertabLink_4").removeClass('active');
            $("#innertabContent_2").hide();
            $("#innertabContent_3").hide();
            $("#innertabContent_4").hide();
        }


        //if ($("#SelectFontOption").val() == "True") {
        //    $("#innertabLink_1").addClass('active');
        //    $("#innertabContent_1").show();
        //} else {
        //    $("#innertabContent_1").hide();
        //}

        ShowHidePleaseWait('N');
    }
    else {
        ShowHidePleaseWait('N');
        $('#imgFollow').hide();
        $("#msgcontent").attr("class", "info");
        $('#msgcontent').html("eSignature is not applicable for XML and Data signing.");
        $("#btnmsgcancel").hide();
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
    }
});

$('body').on("click", "#btncancelDigitalSignature", function () {

    $("#Signaturedropdown").modal('hide');
    //function btncancelDigitalSignature() {
    dsignsignatureValidation = false;
    $("#hdnSignatureImageOption").val("");
    if ($("#SelectFontOption").val() == "True") {
        innertabLink = "innertabLink_1";
    } else
        if ($("#DrawSignatureOption").val() == "True") {
            innertabLink = "innertabLink_2";
        } else if ($("#UploadSignatureOption").val() == "True") {
            innertabLink = "innertabLink_3";
        } else if ($("#eSignaturePadOption").val() == "True") {
            innertabLink = "innertabLink_4";
        }
    //}
});
$("#btnDsign,#btnDigitalsign").on("click", function () {
    var FileType = $("#hdnFileType").val();

    if (FileType == "HASH") {
        ShowHidePleaseWait('N');
        $('#imgFollow').hide();
        $("#msgcontent").attr("class", "info");
        $('#msgcontent').html("Digital Signature is not applicable for HASH signing.");
        $("#btnmsgcancel").hide();
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
        return false;
    }

    if (dsignsignatureValidation) {
        if (innertabLink != "") {
            var ImageData = "";
            if (SignatureImg == "" || SignatureImg == null) {
                if ($("#hdnSignatureImageOption").val() == 1) {
                    ImageData = $("#SignatureImage").val();
                }
                else if ($("#hdnSignatureImageOption").val() == 2) {
                    if ($("#signature").jSignature('getData', 'native') != 0) {
                        ImageData = $('#signature').jSignature('getData');
                    }
                    else {
                        ImageData = "";
                    }
                }
                else if ($("#hdnSignatureImageOption").val() == 3) {
                    ImageData = $('#hdnFilePath').val();
                }
                else if ($("#hdnSignatureImageOption").val() == 4) {
                    ImageData = $("#hdntopozImagevalue").val();
                    $('#hdnSignatureImagevisible').val(1);
                }
            } else {
                ImageData = SignatureImg;
            }

            if (ImageData == "") {

                ShowHidePleaseWait('N');
                $('#imgFollow').hide();
                $("#msgcontent").attr("class", "info");
                if (innertabLink == "innertabLink_1") {
                    if ($("#SelectFontOption").val() == "True") {
                        $('#msgcontent').html("Please select any one font option.");
                    }
                } else
                    if (innertabLink == "innertabLink_2") {
                        if ($("#DrawSignatureOption").val() == "True") {
                            $('#msgcontent').html("Please Draw an image.");
                        }
                    } else if (innertabLink == "innertabLink_3") {
                        if ($("#UploadSignatureOption").val() == "True") {
                            $('#msgcontent').html("Please upload an image with maximum of 200kb and minimum 100kb");
                        }
                    } else if (innertabLink == "innertabLink_4") {
                        if ($("#eSignaturePadOption").val() == "True") {
                            $('#msgcontent').html("Please select Pad Option");
                        }
                    }
                $("#btnmsgcancel").hide();
                $(".alertWindow").css({ 'display': "block" });
                $('#btnmsgok').html('OK');
                $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                return false;
            }
        }
    }
    ShowHidePleaseWait('Y');
    var AuthToken = $("#hdnAuthToken").val();
    var IsCompressed = $("#hdnIsCompressed").val();
    if (FileType == "PDF") {

        var SelectedValue, selectedSignaturePosition, Page;
        var IsCustomizeds = $("#IsCustomized").val();
        if (IsCustomizeds == "True") {
            SelectedValue = $('#ddlPageSelection option:selected').val();
            selectedSignaturePosition = $('#ddlSignaturePosition option:selected').val();
            Page = $('#ddlPageSelection option:selected').val();
            if (SelectedValue == "PAGE LEVEL") {
                var currentId = 1;
                var signatorylength = $(".Signatory" + currentId).length;
                var config = "";
                for (i = 1; i <= signatorylength; i++) {
                    var Page1 = $('#fieldPagination_' + i + ' option:selected').val();
                    var id1 = $('#draggableDiv_' + currentId + '_' + i)[0];
                    var Width = id1.offsetWidth;
                    var Height = id1.offsetHeight;
                    var Left = id1.offsetLeft;
                    var Top = id1.offsetTop;
                    Top = $('.documentVisual img').height() - Top;
                    Height = (Number(Top) - Number(Height));
                    Width = (Number(Left) + Number(Width));
                    config += Page1 + ',' + Left + ',' + Top + ',' + Width + ',' + Height + ';';

                    Coordinates = Page1 + ',' + Left + ',' + Top + ',' + Width + ',' + Height;
                    updCord = "true";
                    customselectPage = "true";
                }
                config = config.substring(0, config.length - 1);
                var pageNumbers = config;
                $("#hdnPagelevelCordinates").val(pageNumbers);
                $("#hdnCoordinates").val(pageNumbers);
            }
            if (SelectedValue == "SPECIFY") {
                if ($('#txtPageNumber').val() == "") {
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html("Enter Pageno");
                    $(".alertWindow").css({ 'display': "block" });
                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                    ShowHidePleaseWait('N');
                    return false;
                }
                if ($('#txtPageNumber').val() != "") {
                    var length = Specifyval;
                    if (length == 0) {
                        $("#btnmsgcancel").hide();
                        $("#msgcontent").attr("class", "info");
                        $('#msgcontent').html("Please click on apply button to save page settings");
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                        ShowHidePleaseWait('N');
                        return false;
                    }
                }
                var csvPageNumbers = $('#hdnPageNumber').val().split(',');
                if (csvPageNumbers == "") {
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html("Please click on apply button to save page settings");
                    $(".alertWindow").css({ 'display': "block" });
                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                    ShowHidePleaseWait('N');
                    return false;
                }
            }
        }
        else {
            SelectedValue = $('#hdnSelectPage').val();
            selectedSignaturePosition = $('#hdnSigPosition').val();
            Page = $("#hdnSelectPage").val();
        }

        // var selectedSignaturePosition = $('#hdnSigPosition').val();
        var InitialsCoordinates = null;
        if ($("#EnableInitials").val() == "True") { InitialsCoordinates = GetInitialsCoordinatesforSigning(); }
        Validatecoordinate();
        // var Page = $("#hdnSelectPage").val();
        var Pagelength = $("#hdnNoOfPages").val();
        var Coordinates = "";
        var PageNumber = "";
        // var SelectedValue = $("#hdnSelectPage").val();
        if (SelectedValue == "FIRST") {
            PageNumber = 1;
        }
        else if (SelectedValue == "ALL") {
            for (i = 0; i < parseInt(Pagelength); i++) {
                PageNumber += (i + 1) + ",";
            }
        }
        else if (SelectedValue == "EVEN") {
            for (i = 0; i < Pagelength; i++) {
                if (((i + 1) % 2) == 0) {
                    PageNumber += (i + 1) + ",";
                }
            }
        }
        else if (SelectedValue == "ODD") {
            for (i = 0; i < Pagelength; i++) {
                if (((i + 1) % 2) != 0) {
                    PageNumber += (i + 1) + ",";
                }
            }
        }
        else if (SelectedValue == "LAST") {
            PageNumber = Pagelength;
        }
        var docType = $("#hdnDocType").val();
        if (IsCustomizeds == "True") {
            Coordinates = $("#hdnCoordinates").val();
            if (Coordinates == "") {
                Coordinates = $("#hdnCustomizecoordinates").val();
                if (Coordinates == "") {
                    Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
                }
            }
        }
        else {
            Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
        }
        if (SelectedValue == "SPECIFY") {
            PageNumber = $("#hdnPageNumber").val();
            //Coordinates = $("#hdnNewcoordinates").val();
        }
        else if (SelectedValue == "PAGE LEVEL") {
            PageNumber = $("#hdnPagelevelCordinates").val();
            Coordinates = $("#hdnPagelevelCordinates").val();
        }
        var filename = $("#hdnFileFullPath").val();
        var Name = $("#hdnName").val();
        var ImageData = "";
        if ($("#hdnSignatureImageOption").val() == 1) {
            ImageData = $("#SignatureImage").val();
        }
        else if ($("#hdnSignatureImageOption").val() == 2) {
            if ($("#signature").jSignature('getData', 'native') != 0) {
                ImageData = $('#signature').jSignature('getData');
            }
            else {
                ImageData = "";
            }
        }
        else if ($("#hdnSignatureImageOption").val() == 3) {
            ImageData = $('#hdnFilePath').val();
        }
        else if ($("#hdnSignatureImageOption").val() == 4) {
            ImageData = $("#hdntopozImagevalue").val();
            $('#hdnSignatureImagevisible').val(1);
        }
        $.ajax({
            url: GenerateMultipleHashURL,
            type: "POST",
            dataType: "json",
            data: { "Name": Name, "Page": Page, "PageNumber": PageNumber, "Coordinates": Coordinates, "filename": filename, "AuthToken": AuthToken, "SignatureImage": ImageData, "SignatureOption": $("#hdnSignatureImageOption").val(), "Cosign": $("#IsCosign").val(), "InitialsCoordinates": InitialsCoordinates, __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
            success: function (data) {
                if (data.Status == 1) {
                    ShowHidePleaseWait('N');
                    var FinalHash = data.lstHashValue[0];
                    var stringarray = new Array();
                    stringarray[0] = 0;
                    stringarray[1] = FinalHash;
                    stringarray[2] = filename;
                    stringarray[3] = false;
                    stringarray[4] = "";
                    $.ajax({
                        url: FetchconfigUrl,
                        type: "POST",
                        data: { "Inputdata": stringarray, "FileType": FileType, "IsCompressed": IsCompressed, "Isgstn": $("#hdnIsGSTN").val(), "Isgstn3b": $("#hdnIsGSTN3B").val(), __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
                        dataType: "json",
                        success: function (data) {
                            if (connection_final == null) {
                                alertmessage();
                                return false;
                            }
                            else {
                                connection_final.send(data.encryptedValue);
                                connection_final.onerror = function (error) {
                                    alertmessage();
                                    ShowHidePleaseWait('N');
                                };
                                connection_final.onmessage = function (e) {
                                    var Output = e.data.slice(0, -26);
                                    if (Output != "status = success") {
                                        if (e.data.indexOf("subProtocol") == -1) {
                                            var embidSignature = e.data.replace('signature=', '');
                                            var embidsig = embidSignature.split("serial");
                                            if (embidsig[0] != "\n") {
                                                var data = embidsig[0];
                                                var dSignDocumnetIDs = 1;
                                                var FileName = $("#hdnFileFullPath").val();
                                                $.ajax({
                                                    url: PrepareDocumentURL,
                                                    type: "POST",
                                                    data: { "Inputdata": data, "AuthToken": AuthToken, "IsCompressed": IsCompressed, __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
                                                    dataType: "json",
                                                    success: function (data) {
                                                        $(".loader").fadeOut("slow");
                                                        if (data.Value == "Success") {
                                                            ShowHidePleaseWait('N');
                                                            window.location.href = '/eMsecure/V3_0/SendSuccessResponse';
                                                        }
                                                        else {
                                                            ShowHidePleaseWait('N');
                                                            window.location.href = '/eMsecure/V3_0/SendErrorResponse';
                                                        }
                                                    },
                                                    error: function (e) {
                                                        ShowHidePleaseWait('N');
                                                        $("#btnmsgcancel").hide();
                                                        $("#msgcontent").attr("class", "error");
                                                        $('#msgcontent').html("Some error occured.Please try after sometime");
                                                        $(".alertWindow").css({ 'display': "block" });
                                                        $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
                                                    }
                                                });
                                            }
                                            else {
                                                ShowHidePleaseWait('N');
                                            }
                                        }
                                    }
                                };
                            }
                        },
                        error: function (e) {
                            ShowHidePleaseWait('N');
                            $("#btnmsgcancel").hide();
                            $("#msgcontent").attr("class", "error");
                            $('#msgcontent').html("Some error occured.Please try after sometime");
                            $(".alertWindow").css({ 'display': "block" });
                            $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
                        }
                    });
                }
                else if (data.Status == 0) {
                    ShowHidePleaseWait('N');
                    $('#imgFollow').hide();
                    $("#msgcontent").attr("class", "error");
                    if (data.Message == "PdfReader not opened with owner password") {
                        $('#msgcontent').html("The uploaded PDF file is restricted from signing.");
                    } else {
                        $('#msgcontent').html(data.Message);
                    }
                    $("#btnmsgcancel").hide();
                    $(".alertWindow").css({ 'display': "block" });
                    $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
                }
            },
            error: function (e) {
                ShowHidePleaseWait('N');
                $('#imgFollow').hide();
                $("#btnmsgcancel").hide();
                $("#msgcontent").attr("class", "error");
                $('#msgcontent').html("Some error occured.Please try after sometime");
                $(".alertWindow").css({ 'display': "block" });
                $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
            }
        });
    }
    else if (FileType == "XML") {
        ShowHidePleaseWait('Y');
        var data = $("#hdnBase64FileData").val();
        var stringarray = new Array();
        stringarray[0] = 0;
        stringarray[1] = data;
        stringarray[2] = "XML";
        stringarray[3] = false;
        stringarray[4] = "";
        $.ajax({
            url: FetchconfigUrl,
            type: "POST",
            data: { "Inputdata": stringarray, "FileType": FileType, "IsCompressed": IsCompressed, "Isgstn": $("#hdnIsGSTN").val(), "Isgstn3b": $("#hdnIsGSTN3B").val(), __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
            dataType: "json",
            success: function (data) {
                if (connection_final == null) {
                    alertmessage();
                    return false;
                }
                else {
                    connection_final.send(data.encryptedValue);
                    connection_final.onerror = function (error) {
                        alertmessage();
                        ShowHidePleaseWait('N');
                    };
                    ShowHidePleaseWait('N');
                    connection_final.onmessage = function (e) {
                        var Output = e.data.slice(0, -26);
                        if (Output != "status = success") {
                            if (e.data.indexOf("subProtocol") == -1) {
                                var embidSignature = e.data.replace('signature=', '');
                                var embidsig = embidSignature.split("serial");
                                if (embidsig[0] != "\n") {
                                    var data = embidsig[0];
                                    var FileType = $("#hdnFileType").val();
                                    ShowHidePleaseWait('Y');
                                    $.ajax({
                                        url: PrepareXMLDATAURL,
                                        type: "POST",
                                        data: { "Inputdata": data, "AuthToken": AuthToken, "Isgstn": $("#hdnIsGSTN").val(), "IsCompressed": $("#hdnIsCompressed").val(), "Isgstn3b": $("#hdnIsGSTN3B").val(), __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
                                        dataType: "json",
                                        success: function (data) {
                                            $(".loader").fadeOut("slow");
                                            if (data.Value == "Success") {
                                                ShowHidePleaseWait('N');
                                                window.location.href = '/eMsecure/V3_0/SendSuccessResponse';
                                            }
                                            else {
                                                ShowHidePleaseWait('N');
                                                window.location.href = '/eMsecure/V3_0/SendErrorResponse';
                                            }
                                        },
                                        error: function (e) {
                                            ShowHidePleaseWait('N');
                                            $("#btnmsgcancel").hide();
                                            $("#msgcontent").attr("class", "error");
                                            $('#msgcontent').html(e.Message);
                                            $(".alertWindow").css({ 'display': "block" });
                                            $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
                                        }
                                    });
                                }
                                else {
                                    ShowHidePleaseWait('N');
                                }
                            }
                        }
                    };
                }
            },
            error: function (e) {
                ShowHidePleaseWait('N');
                $("#btnmsgcancel").hide();
                $("#msgcontent").attr("class", "error");
                $('#msgcontent').html(e);
                $(".alertWindow").css({ 'display': "block" });
                $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
            }
        });
    }
    else {
        ShowHidePleaseWait('Y');
        var data = $("#hdnBase64FileData").val();
        var stringarray = new Array();
        stringarray[0] = 0;
        stringarray[1] = data;
        stringarray[2] = "DATA";
        stringarray[3] = false;
        stringarray[4] = "";
        var FileType = $("#hdnFileType").val();
        $.ajax({
            url: FetchconfigUrl,
            type: "POST",
            data: { "Inputdata": stringarray, "FileType": FileType, "IsCompressed": IsCompressed, "Isgstn": $("#hdnIsGSTN").val(), "Isgstn3b": $("#hdnIsGSTN3B").val(), __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
            dataType: "json",
            success: function (data) {
                if (connection_final == null) {
                    ShowHidePleaseWait('N');
                    alertmessage();
                    return false;
                }
                else {
                    connection_final.send(data.encryptedValue);
                    connection_final.onerror = function (error) {
                        alertmessage();
                        ShowHidePleaseWait('N');
                    };
                    connection_final.onmessage = function (e) {
                        var Output = e.data.slice(0, -26);
                        if (Output != "status = success") {
                            if (e.data.indexOf("subProtocol") == -1) {
                                var embidSignature = e.data.replace('signature=', '');
                                var embidsig = embidSignature.split("serial");
                                if (embidsig[0] != "\n") {
                                    var data = embidsig[0];
                                    ShowHidePleaseWait('Y');
                                    $.ajax({
                                        url: PrepareXMLDATAURL,
                                        type: "POST",
                                        data: { "Inputdata": data, "AuthToken": AuthToken, "Isgstn": $("#hdnIsGSTN").val(), "IsCompressed": $("#hdnIsCompressed").val(), "Isgstn3b": $("#hdnIsGSTN3B").val(), __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
                                        dataType: "json",
                                        success: function (data) {
                                            $(".loader").fadeOut("slow");
                                            if (data.Value == "Success") {
                                                ShowHidePleaseWait('N');
                                                window.location.href = '/eMsecure/V3_0/SendSuccessResponse';
                                            }
                                            else {
                                                ShowHidePleaseWait('N');
                                                window.location.href = '/eMsecure/V3_0/SendErrorResponse';
                                            }
                                        },
                                        error: function (e) {
                                            ShowHidePleaseWait('N');
                                            $("#btnmsgcancel").hide();
                                            $("#msgcontent").attr("class", "error");
                                            $('#msgcontent').html(e.Message);
                                            $(".alertWindow").css({ 'display': "block" });
                                            $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
                                        }
                                    });
                                }
                                else {
                                    ShowHidePleaseWait('N');
                                }
                            }
                        }
                    };
                }
            },
            error: function (e) {
                ShowHidePleaseWait('N');
                $("#btnmsgcancel").hide();
                $("#msgcontent").attr("class", "error");
                $('#msgcontent').html(e.Message);
                $(".alertWindow").css({ 'display': "block" });
                $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
            }
        });
    }
});
$('#Signaturedropdown .signing-tab .innertab-link').on("click", function () {
    var s = $(this).attr('id'),
        t = s.split("innertabLink_");
    if (s == "innertabLink_1") {
        innertabLink = "innertabLink_1";
        $('input[name="backimg"]').attr('checked', false);
        $("#Signaturedropdown .sign-font-option li").removeClass("selected");
        $(".font-sign").text(DisplayName);
        $("#txtFullName").val(DisplayName);
        $("#hdnSignatureImageOption").val(1);
        $('#signature canvas').remove();
        $('#SignatureImage').val("");
    }
    if (s == "innertabLink_2") {
        innertabLink = "innertabLink_2";
        var CanvasLength = $("#signature canvas").length;
        $("#hdnSignatureImageOption").val(2);
    }
    if (s == "innertabLink_3") {
        innertabLink = "innertabLink_3";
        $("#lblerrormessage").text("");
        $("#txtsignatureimage").val('');
        $('#signature canvas').remove();
        $("#hdnSignatureImageOption").val(3);
        $('#hdnFilePath').val("");
    }
    if (s == "innertabLink_4") {
        innertabLink = "innertabLink_4";
        $("#btnstart").show();
        $("#btntopozreset").hide();
        $("#btncapture").hide();
        $('#imgfingure').attr("src", "");
        $('#signature canvas').remove();
        $("#hdnSignatureImageOption").val(4);
        $("#hdntopozImagevalue").val("");
    }
    if (s == "innertabLink_6") {
        innertabLink = "innertabLink_6";
        var ImageData = "";
        if ($("#hdnSignatureImageOption").val() == 1) {
            ImageData = $('#SignatureImage').val();
        }
        else if ($("#hdnSignatureImageOption").val() == 2) {
            if ($("#signature").jSignature('getData', 'native') != 0) {
                ImageData = $('#signature').jSignature('getData');
            }
            else {
                ImageData = "";
            }
        }
        else if ($("#hdnSignatureImageOption").val() == 3) {
            ImageData = $('#hdnFilePath').val();

        }
        else if ($("#hdnSignatureImageOption").val() == 4) {
            ImageData = $("#hdntopozImagevalue").val();
        }
        if (ImageData != "" && typeof ImageData != "undefined") {
            $("#SignAppearence").show();
        }
        else {
            $("#SignAppearence").hide();
            $("#btnmsgcancel").hide();
            $("#msgcontent").attr("class", "info");
            $('#msgcontent').html("Please select any of the signature options");
            $(".alertWindow").css({ 'display': "block" });
            $('#btnmsgok').text('Ok');
            $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
            return false;
        }

    }
    if (s == "innertabContent_7") {
        innertabLink = "innertabLink_7";
        $("#divimage").show();
    }
    $(".innertab-panel").hide();
    $("#innertabContent_" + t[1]).show();
    $(".innertab-link").removeClass("active");
    $("#innertabLink_" + t[1]).addClass("active");
    if (CanvasLength == 0) {
        $("#signature").jSignature({
            'background-color': 'transparent',
            'decor-color': 'transparent',
            'lineWidth': 5
        });
    }
    if (s == "innertabLink_2") {
        innertabLink = "innertabLink_2";
        $('#signature').jSignature('reset');
    }
});

$("#btntopozreset").on("click", function () {
    $('#imgfingure').attr("src", "");
    $("#btnstart").show();
    $("#topazinfo").show();
    $("#btntopozreset").hide();
    $("#hdnSignatureImageOption").val("");
});

$("#Signaturedropdown .sign-font-option .imgdetails").on("click", function () {
    ShowHidePleaseWait('Y');
    var s = $(this).attr('id');
    var id = s.split('_')[1];
    $("#rbt_" + id).prop("checked", true);
    var selectedId = $("#Signaturedropdown .selected ").attr('id');
    $("#" + selectedId).removeClass("selected");
    $("#" + s).addClass("selected");
    html2canvas(document.getElementById("lbl_" + id + ""), {
        onrendered: function (canvas) {
            base64string = canvas.toDataURL("image/png");
            $("#hdnSignatureImageOption").val(1);
            $("#SignatureImage").val(base64string);
            ShowHidePleaseWait('N');
        }
    });
});

$("#txtFullName").blur(function () {
    var text = $("#txtFullName").val();
    if (text == "") {
        $("#txtFullName").val(DisplayName)
        $(".font-sign").text(DisplayName);
    }
    else {
        $('.font-sign').html(text);
    }
});

$("#eSigncontent").on("click", function () {
    $("#eSigncontent").attr("href", "#eSignMessage");
    $("#eSignMessage").modal('show');
    ShowHidePleaseWait('Y');
    $("#languages").val("English");
    $.ajax({
        url: ChangeLanguageUrl,
        type: "POST",
        data: { "Language": "English", __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
        dataType: "json",
        success: function (data) {
            if (data.status == 1) {
                ShowHidePleaseWait('N');
                $("#eSignconsent").text(data.ConsentData);
            }
        },
        error: function (e) {

        }
    });
});

function ViewDocDataURL(FileHashDataURL) {
    window.open(FileHashDataURL, '_blank');
}
function ViewDocData(FileHashData) {
    var FileType = $("#hdnFileType").val();

    if ($("#hdnDocumentdetails").val() != '' && FileType == "HASH") {
        if ($("#hdnIsCompressed").val() == "True") {
            ShowHidePleaseWait('Y');
            var FileData = $("#hdnBase64FileData").val();
            var FileType = $("#hdnFileType").val();
            $.ajax({
                url: FileContentDEcompressionURL,
                type: "POST",
                data: { "FileData": FileData, "FileType": FileType, __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
                dataType: "json",
                success: function (data) {
                    $("#divdata").hide();
                    $("#divdata").modal('hide');
                    if (data.status == 1) {
                        if ($("#hdnIsGSTN3B").val() == "True") {
                            var gstn3bData = data.File.split('~');
                            $("#parta").empty();
                            $("#partb").empty();
                            $("#parta").text(gstn3bData[0]);
                            $("#partb").text(gstn3bData[1]);
                        }
                        else {
                            $("#showFilecontent").empty();
                            $("#iscomp3b").hide();
                            $("#showFilecontent").text(FileHashData);
                        }
                        $("#divdata").modal('hide');
                        $("#divedata").modal('show');
                        $("#viewfilecontent").attr("href", "#filecontent");
                        $("#filecontent").modal('show');
                        ShowHidePleaseWait('N');
                    }
                    else {
                        ShowHidePleaseWait('N');
                        $("#btnmsgcancel").hide();
                        $("#msgcontent").attr("class", "info");
                        $('#msgcontent').html(data.File);
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').text('Ok');
                        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                        return false;
                    }
                    $("#divdata").hide();
                },
                error: function (e) {
                    ShowHidePleaseWait('N');
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html(e);
                    $(".alertWindow").css({ 'display': "block" });
                    $('#btnmsgok').text('Ok');
                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                    return false;
                }
            });
        }
        else {
            ShowHidePleaseWait('Y');
            if ($("#hdnIsGSTN3B").val() == "True") {
                var gstn3bData = atob($("#hdnBase64FileData").val()).split('~');
                $("#parta").empty();
                $("#partb").empty();
                $("#parta").text(gstn3bData[0]);
                $("#partb").text(gstn3bData[1]);
            }
            else {
                $("#iscomp3b").hide();
                $("#showFilecontent").empty();
                //var actualData = atob($("#hdnBase64FileData").val());
                $("#showFilecontent").text(FileHashData);
            }
            $("#viewfilecontent").attr("href", "#filecontent");
            $("#filecontent").modal('show');
            ShowHidePleaseWait('N');
        }
    } else
        if (FileType == "XML" || FileType == "DATA") {
            if ($("#hdnIsCompressed").val() == "True") {
                ShowHidePleaseWait('Y');
                var FileData = $("#hdnBase64FileData").val();
                var FileType = $("#hdnFileType").val();
                $.ajax({
                    url: FileContentDEcompressionURL,
                    type: "POST",
                    data: { "FileData": FileData, "FileType": FileType },
                    dataType: "json",
                    success: function (data) {
                        if (data.status == 1) {
                            if ($("#hdnIsGSTN3B").val() == "True") {
                                var gstn3bData = data.File.split('~');
                                $("#parta").empty();
                                $("#partb").empty();
                                $("#parta").text(gstn3bData[0]);
                                $("#partb").text(gstn3bData[1]);
                            }
                            else {
                                $("#showFilecontent").empty();
                                $("#iscomp3b").hide();
                                $("#showFilecontent").text(data.File);
                            }
                            $("#viewfilecontent").attr("href", "#filecontent");
                            $("#filecontent").modal('show');
                            ShowHidePleaseWait('N');
                        }
                        else {
                            ShowHidePleaseWait('N');
                            $("#btnmsgcancel").hide();
                            $("#msgcontent").attr("class", "info");
                            $('#msgcontent').html(data.File);
                            $(".alertWindow").css({ 'display': "block" });
                            $('#btnmsgok').text('Ok');
                            $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                            return false;
                        }
                    },
                    error: function (e) {
                        ShowHidePleaseWait('N');
                        $("#btnmsgcancel").hide();
                        $("#msgcontent").attr("class", "info");
                        $('#msgcontent').html(e);
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').text('Ok');
                        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                        return false;
                    }
                });
            }
            else {
                ShowHidePleaseWait('Y');
                if ($("#hdnIsGSTN3B").val() == "True") {
                    var gstn3bData = atob($("#hdnBase64FileData").val()).split('~');
                    $("#parta").empty();
                    $("#partb").empty();
                    $("#parta").text(gstn3bData[0]);
                    $("#partb").text(gstn3bData[1]);
                }
                else {
                    $("#iscomp3b").hide();
                    $("#showFilecontent").empty();
                    var actualData = atob($("#hdnBase64FileData").val());
                    $("#showFilecontent").text(actualData);
                }
                $("#viewfilecontent").attr("href", "#filecontent");
                $("#filecontent").modal('show');
                ShowHidePleaseWait('N');
            }
        } else
            if ($("#hdnDocumentdetails").val() != '' && FileType == "HASH") {
                if ($("#hdnIsCompressed").val() == "True") {
                    ShowHidePleaseWait('Y');
                    var FileData = $("#hdnBase64FileData").val();
                    var FileType = $("#hdnFileType").val();
                    $.ajax({
                        url: FileContentDEcompressionURL,
                        type: "POST",
                        data: { "FileData": FileData, "FileType": FileType },
                        dataType: "json",
                        success: function (data) {
                            $("#divdata").hide();
                            $("#divdata").modal('hide');
                            if (data.status == 1) {
                                if ($("#hdnIsGSTN3B").val() == "True") {
                                    var gstn3bData = data.File.split('~');
                                    $("#parta").empty();
                                    $("#partb").empty();
                                    $("#parta").text(gstn3bData[0]);
                                    $("#partb").text(gstn3bData[1]);
                                }
                                else {
                                    $("#showFilecontent").empty();
                                    $("#iscomp3b").hide();
                                    $("#showFilecontent").text(data.File);
                                }
                                $("#divdata").modal('hide');
                                $("#divedata").modal('show');
                                $("#viewfilecontent").attr("href", "#filecontent");
                                $("#filecontent").modal('show');
                                ShowHidePleaseWait('N');
                            }
                            else {
                                ShowHidePleaseWait('N');
                                $("#btnmsgcancel").hide();
                                $("#msgcontent").attr("class", "info");
                                $('#msgcontent').html(data.File);
                                $(".alertWindow").css({ 'display': "block" });
                                $('#btnmsgok').text('Ok');
                                $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                                return false;
                            }
                            $("#divdata").hide();
                        },
                        error: function (e) {
                            ShowHidePleaseWait('N');
                            $("#btnmsgcancel").hide();
                            $("#msgcontent").attr("class", "info");
                            $('#msgcontent').html(e);
                            $(".alertWindow").css({ 'display': "block" });
                            $('#btnmsgok').text('Ok');
                            $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                            return false;
                        }
                    });
                }
                else {
                    ShowHidePleaseWait('Y');
                    if ($("#hdnIsGSTN3B").val() == "True") {
                        var gstn3bData = atob($("#hdnBase64FileData").val()).split('~');
                        $("#parta").empty();
                        $("#partb").empty();
                        $("#parta").text(gstn3bData[0]);
                        $("#partb").text(gstn3bData[1]);
                    }
                    else {
                        $("#iscomp3b").hide();
                        $("#showFilecontent").empty();
                        var actualData = atob($("#hdnBase64FileData").val());
                        $("#showFilecontent").text(actualData);
                    }
                    $("#viewfilecontent").attr("href", "#filecontent");
                    $("#filecontent").modal('show');
                    ShowHidePleaseWait('N');
                }
            }
            else {
                window.open('/eMsecure/SignerGateway/FileView', '_blank');
            }
}
$("#viewfilecontent").on("click", function () {
    var FileType = $("#hdnFileType").val();

    if ($("#hdnDocumentdetails").val() != '' && FileType == "DATA") {
        if ($("#hdnIsCompressed").val() == "True") {
            ShowHidePleaseWait('Y');
            var FileData = $("#hdnBase64FileData").val();
            var FileType = $("#hdnFileType").val();
            $.ajax({
                url: FileContentDEcompressionURL,
                type: "POST",
                data: { "FileData": FileData, "FileType": FileType },
                dataType: "json",
                success: function (data) {
                    $("#divdata").hide();
                    $("#divdata").modal('hide');
                    if (data.status == 1) {
                        if ($("#hdnIsGSTN3B").val() == "True") {
                            var gstn3bData = data.File.split('~');
                            $("#parta").empty();
                            $("#partb").empty();
                            $("#parta").text(gstn3bData[0]);
                            $("#partb").text(gstn3bData[1]);
                        }
                        else {
                            $("#showFilecontent").empty();
                            $("#iscomp3b").hide();
                            $("#showFilecontent").text(data.File);
                        }
                        $("#divdata").modal('hide');
                        $("#divedata").modal('show');
                        $("#viewfilecontent").attr("href", "#filecontent");
                        $("#filecontent").modal('show');
                        ShowHidePleaseWait('N');
                    }
                    else {
                        ShowHidePleaseWait('N');
                        $("#btnmsgcancel").hide();
                        $("#msgcontent").attr("class", "info");
                        $('#msgcontent').html(data.File);
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').text('Ok');
                        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                        return false;
                    }
                    $("#divdata").hide();
                },
                error: function (e) {
                    ShowHidePleaseWait('N');
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html(e);
                    $(".alertWindow").css({ 'display': "block" });
                    $('#btnmsgok').text('Ok');
                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                    return false;
                }
            });
        }
        else {
            ShowHidePleaseWait('Y');
            if ($("#hdnIsGSTN3B").val() == "True") {
                var gstn3bData = atob($("#hdnBase64FileData").val()).split('~');
                $("#parta").empty();
                $("#partb").empty();
                $("#parta").text(gstn3bData[0]);
                $("#partb").text(gstn3bData[1]);
            }
            else {
                $("#iscomp3b").hide();
                $("#showFilecontent").empty();
                var actualData = atob($("#hdnBase64FileData").val());
                $("#showFilecontent").text(actualData);
            }
            $("#viewfilecontent").attr("href", "#filecontent");
            $("#filecontent").modal('show');
            ShowHidePleaseWait('N');
        }
    } else
        if (FileType == "XML" || FileType == "DATA") {
            if ($("#hdnIsCompressed").val() == "True") {
                ShowHidePleaseWait('Y');
                var FileData = $("#hdnBase64FileData").val();
                var FileType = $("#hdnFileType").val();
                $.ajax({
                    url: FileContentDEcompressionURL,
                    type: "POST",
                    data: { "FileData": FileData, "FileType": FileType },
                    dataType: "json",
                    success: function (data) {
                        if (data.status == 1) {
                            if ($("#hdnIsGSTN3B").val() == "True") {
                                var gstn3bData = data.File.split('~');
                                $("#parta").empty();
                                $("#partb").empty();
                                $("#parta").text(gstn3bData[0]);
                                $("#partb").text(gstn3bData[1]);
                            }
                            else {
                                $("#showFilecontent").empty();
                                $("#iscomp3b").hide();
                                $("#showFilecontent").text(data.File);
                            }
                            $("#viewfilecontent").attr("href", "#filecontent");
                            $("#filecontent").modal('show');
                            ShowHidePleaseWait('N');
                        }
                        else {
                            ShowHidePleaseWait('N');
                            $("#btnmsgcancel").hide();
                            $("#msgcontent").attr("class", "info");
                            $('#msgcontent').html(data.File);
                            $(".alertWindow").css({ 'display': "block" });
                            $('#btnmsgok').text('Ok');
                            $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                            return false;
                        }
                    },
                    error: function (e) {
                        ShowHidePleaseWait('N');
                        $("#btnmsgcancel").hide();
                        $("#msgcontent").attr("class", "info");
                        $('#msgcontent').html(e);
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').text('Ok');
                        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                        return false;
                    }
                });
            }
            else {
                ShowHidePleaseWait('Y');
                if ($("#hdnIsGSTN3B").val() == "True") {
                    var gstn3bData = atob($("#hdnBase64FileData").val()).split('~');
                    $("#parta").empty();
                    $("#partb").empty();
                    $("#parta").text(gstn3bData[0]);
                    $("#partb").text(gstn3bData[1]);
                }
                else {
                    $("#iscomp3b").hide();
                    $("#showFilecontent").empty();
                    var actualData = atob($("#hdnBase64FileData").val());
                    $("#showFilecontent").text(actualData);
                }
                $("#viewfilecontent").attr("href", "#filecontent");
                $("#filecontent").modal('show');
                ShowHidePleaseWait('N');
            }
        } else
            if ($("#hdnDocumentdetails").val() != '' && FileType == "HASH") {
                if ($("#hdnIsCompressed").val() == "True") {
                    ShowHidePleaseWait('Y');
                    var FileData = $("#hdnBase64FileData").val();
                    var FileType = $("#hdnFileType").val();
                    $.ajax({
                        url: FileContentDEcompressionURL,
                        type: "POST",
                        data: { "FileData": FileData, "FileType": FileType },
                        dataType: "json",
                        success: function (data) {
                            $("#divdata").hide();
                            $("#divdata").modal('hide');
                            if (data.status == 1) {
                                if ($("#hdnIsGSTN3B").val() == "True") {
                                    var gstn3bData = data.File.split('~');
                                    $("#parta").empty();
                                    $("#partb").empty();
                                    $("#parta").text(gstn3bData[0]);
                                    $("#partb").text(gstn3bData[1]);
                                }
                                else {
                                    $("#showFilecontent").empty();
                                    $("#iscomp3b").hide();
                                    $("#showFilecontent").text(data.File);
                                }
                                $("#divdata").modal('hide');
                                $("#divedata").modal('show');
                                $("#viewfilecontent").attr("href", "#filecontent");
                                $("#filecontent").modal('show');
                                ShowHidePleaseWait('N');
                            }
                            else {
                                ShowHidePleaseWait('N');
                                $("#btnmsgcancel").hide();
                                $("#msgcontent").attr("class", "info");
                                $('#msgcontent').html(data.File);
                                $(".alertWindow").css({ 'display': "block" });
                                $('#btnmsgok').text('Ok');
                                $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                                return false;
                            }
                            $("#divdata").hide();
                        },
                        error: function (e) {
                            ShowHidePleaseWait('N');
                            $("#btnmsgcancel").hide();
                            $("#msgcontent").attr("class", "info");
                            $('#msgcontent').html(e);
                            $(".alertWindow").css({ 'display': "block" });
                            $('#btnmsgok').text('Ok');
                            $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                            return false;
                        }
                    });
                }
                else {
                    ShowHidePleaseWait('Y');
                    if ($("#hdnIsGSTN3B").val() == "True") {
                        var gstn3bData = atob($("#hdnBase64FileData").val()).split('~');
                        $("#parta").empty();
                        $("#partb").empty();
                        $("#parta").text(gstn3bData[0]);
                        $("#partb").text(gstn3bData[1]);
                    }
                    else {
                        $("#iscomp3b").hide();
                        $("#showFilecontent").empty();
                        var actualData = atob($("#hdnBase64FileData").val());
                        $("#showFilecontent").text(actualData);
                    }
                    $("#viewfilecontent").attr("href", "#filecontent");
                    $("#filecontent").modal('show');
                    ShowHidePleaseWait('N');
                }
            }
            else {
                window.open('/eMsecure/SignerGateway/FileView', '_blank');
            }
    //}else{
    //    }
});
$("#Portsetting").click(function () {
    $("#Portsetting").attr("href", "#Portsettings");
    $("#Portsettings").modal('show');
    if (PortList == "0") {
        $("#txtPortNumber").val("1646");
    }
    else {
        $("#txtPortNumber").val(PortList);

    }
});

$("#btnESignMessageCancel").on("click", function () {
    $("#chkdeclaration").prop("checked", true);
    $('#eSignMessage').modal('hide');


});

$("#btnfilecontentcancel").on("click", function () {
    $('#filecontent').modal('hide');
});

$("#btnReset").on("click", function () {
    $('input[name="backimg"]').attr('checked', false);
    $("#Signaturedropdown .sign-font-option li").removeClass("selected");
    $("#hdnSignatureImageOption").val("");
});

$("#btnResetbrowse").on("click", function () {
    $("#txtsignatureimage").val('');
    $("#lblerrormessage").text("");
    $("input[name='SignatureImage']").val("");
    $("#hdnSignatureImageOption").val("");
});

function SpaceRestriction(e) {
    if ($('#txtFullName').val().length == 0) {
        if (e.keyCode == 32) {
            e.preventDefault();
        }
    }
}
//--------------------------------------------Customize and signature placeholder----------------------------------------------


$('#btnCompanyImage').fileupload({
    maxFileSize: AttachmentSize,
    url: SaveBackgroundCompanyImageURL,
    formData: function (form) {
        return [{ name: "__RequestVerificationToken", value: $('[name= "__RequestVerificationToken"]').val() }];
    },
    add: function (e, data) {
        if (data.files[0].type != "image/jpeg") {
            $('#btnmsgok').removeAttr('onClick');
            $("#btnmsgcancel").hide();
            $("#msgcontent").attr("class", "info");
            $('#msgcontent').html('NOTE: Only .jpg,.jpeg files can be set as Company Stamp.');
            $(".alertWindow").css({ 'display': "block" });
            $('#btnmsgok').text('Ok');
            $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
            return false;
        }
        if (data.files[0].size <= AttachmentSize) {
            data.submit();
        }
        else {
            $("#btnmsgcancel").hide();
            $("#msgcontent").attr("class", "info");
            $('#msgcontent').html(MessageForAttachmentSize);
            $(".alertWindow").css({ 'display': "block" });
            $('#btnmsgok').text('Ok');
            $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
            return false;
        }
    },
    success: function (data, status) {
        $('#txtcompanyimage').val(data.Fullpath);
        var newUrl = "/Companystamps/" + data.FileName;
        $("#CompanystampImg").attr("src", newUrl);
        CompanyStamp = data.FileName;
    },
    done: function (e, data) {
    },
    error: function (error) {
    }
});

$("#btnAppearancereset").on("click", function () {
    $("input[name='rbtnsignappearence']").prop('checked', false);
});

$("#btnstart").on('click', function () {
    ShowHidePleaseWait('Y');
    if (connection_final == null) {
        ShowHidePleaseWait('N');
        alertmessage();
        return false;
    }
    else {
        $.ajax({
            url: FetchconfigtopazUrl,
            type: "POST",
            data: { "Action": "start", __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
            dataType: "json",
            success: function (data) {
                connection_final.send(data.encryptedValue);
                connection_final.onerror = function (error) {
                    alertmessage();
                    ShowHidePleaseWait('N');
                };
                connection_final.onmessage = function (e) {
                    var Output = e.data.indexOf("subProtocol");
                    if (Output != "success") {
                        ShowHidePleaseWait('N');
                        var embidSignature = e.data;
                        if (embidSignature == "success") {
                            $("#btncapture").show();
                            $("#btnstart").hide();
                        }
                    }
                }
            }
        });
    }
});

$("#btncapture").on('click', function () {
    ShowHidePleaseWait('Y');
    if (connection_final == null) {
        ShowHidePleaseWait('N');
        alertmessage();
        return false;
    }
    else {
        $.ajax({
            url: FetchconfigtopazUrl,
            type: "POST",
            data: { "Action": "capture", __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
            dataType: "json",
            success: function (data) {
                connection_final.send(data.encryptedValue);
                connection_final.onerror = function (error) {
                    alertmessage();
                    ShowHidePleaseWait('N');
                };
                connection_final.onmessage = function (e) {
                    var Output = e.data.indexOf("subProtocol");
                    if (Output != "success") {
                        ShowHidePleaseWait('N');
                        var embidSignature = e.data;
                        if (embidSignature != "") {
                            $("#btncapture").hide();
                            $("#topazinfo").hide();
                            $("#btntopozreset").show();
                            $("#hdntopozImagevalue").val(embidSignature);
                            $("#hdnSignatureImageOption").val(4);
                            $("#imgfingure").attr("src", "data:image/jpg;base64," + embidSignature);
                        }
                    }
                }
            }
        });
    }
});

$("#txtAdhaarNumber").keypress(function (e) {
    if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
        return false;
    }
});

function alertmessage() {
    var utiText = "<fieldset><legend>1.If  emSigner utility is not installed</legend>";
    //utiText += "<p>Note: emSigner Application is currently available for download only for Microsoft Windows OS</p>";
    utiText += "<p>You're requested to download and install emSigner utility.</p>";
    // utiText += "<p>emSigner application is designed to help F16 signers in merging (PartA & PartB), digitally signing, password-protecting and emailing the digitally signed documents to respective recipients/employees.</p>";
    utiText += "<p>Before you begin make sure you have sufficient privileges to install system services  '<b>Administrator</b>'</p>";
    // utiText += "<li>Sufficient privileges to install system services.'<b>Administrator</b>'</li>";
    // utiText += "<li>System Requirements: Windows OS</li></ol>";
    utiText += "<p>To set up installation of emSigner utility, click <b>Download</b> -> <b>Extract the saved Zip file</b> -> <b>double click</b> on <b>emSigner file </b> -> <b>Install</b> -> <b>Click</b> on <b>emSigner</b> icon->you’re done.</p>";
    if ($("#hdnOSName").val() == "Windows" || OSName == "Windows") {
        utiText += "<p>For more information about emSigner utility installation process.</p>";
        utiText += "<p>Please <a target='_blank' href='http://support.emsigner.com/category/how-do-i-install-emsigner-utility-windows'>Click here</a></p></fieldset>";
    }
    else if ($("#hdnOSName").val() == "MacOS" || OSName == "MacOS") {
        utiText += "<p>For more information about emSigner utility installation process.</p>";
        utiText += "<p>Please <a target='_blank' href='http://support.emsigner.com/category/how-do-i-install-emsigner-utility-mac'>Click here</a></p></fieldset>";
    }
    else {
        utiText += "<p>For more information about emSigner utility installation process.</p>";
        utiText += "<p>Please <a target='_blank' href='http://support.emsigner.com/category/how-do-i-install-emsigner-utility-linux'>Click here</a></p></fieldset>";
    }
    utiText += "<fieldset><legend>2.If you already have emSigner utility installed</legend>";
    utiText += "<p>We've <b>upgraded</b> the emSigner utility for better experience. You are requested to kindly <b>uninstall</b> the older version and download & install the <b>upgraded version</b> of emSigner utility.</p>";
    utiText += "<p>Refer to utility installation process in step 1 above.</p>";
    utiText += "<p><b>Note:</b>  Old utility will not work going forward for signing. This is one time activity to install the new utility and it will automatically get updated in future.</p></fieldset>";
    // utiText += "<p>To set up installation of emSigner utility, click <b>Download</b> -> <b>Extract the saved Zip file</b> -> <b>Right click on emSigner.msi </b> -> <b>Install</b> -> <b>Go to Start Menu</b>-><b>Click</b> on <b>emSigner</b> icon->you’re done.</p></fieldset>";
    utiText += "<fieldset><legend>3.If emSigner utility is Not Running</legend>";
    utiText += "<p>If you’ve already installed the latest version of emSigner utility and due to some reason it’s stopped then no need to re-install again. Please start the service and you are ready.</p>";
    utiText += "<p>To start emSigner utility, Just <b>double click</b> on emSigner icon.</p></fieldset>";
    ShowHidePleaseWait('N');
    $('#btnutilitycancel').show();
    $("#utilitymsgcontent").attr("class", "install-info");
    $('#utilitymsgcontent').html(utiText);
    $(".utilityWindow").css({ 'display': "block" }).addClass("alertLarge");
    if ($("#hdnOSName").val() == "Windows" || OSName == "Windows") {
        $('#btnutilityok').attr("href", "/Downloads/emSigner-windows.zip");
    }
    else if ($("#hdnOSName").val() == "MacOS" || OSName == "MacOS") {
        $('#btnutilityok').attr("href", "/Downloads/emsigner_Mac.zip");
    }
    else if ($("#hdnOSName").val() == "UNIX" || OSName == "UNIX") {
        $('#btnutilityok').attr("href", "/Downloads/emsigner_Unix.zip");
    }
    else if ($("#hdnOSName").val() == "Linux" || OSName == "Linux") {
        $('#btnutilityok').attr("href", "/Downloads/emSigner_Linux.zip");
    }
    $('#btnutilitycancel').removeClass("btn-gray");
    $('#btnutilitycancel').attr('href', "javascript:Returncontrol('Y','');");
}


function ViewDocument() {
    var Filename = $("#hdnFileFullPath").val();
    $("#btnview").attr("href", "/eMsecure/SignerGateway/FileView/" + Filename);
}

$(".help-note").on("click", function (e) {
    var s = $(this).attr("id"),
        t = s.split("_");
    $(".help-content").hide();
    $("#helpContent_" + t[1]).show();
});

$(".help-close").on("click", function (e) {
    var s = $(this).attr("id"),
        t = s.split("_");
    $("#helpContent_" + t[1]).hide();
});

$("#helpLink_4").on('click', function (e) {
    $("#helpContent_4").show();
});
$("#helpLink_7").on('click', function (e) {
    $("#helpContent_7").show();
});
$("#helpLink_14").on('click', function (e) {
    $("#helpContent_14").show();
});
//$("#helpLink_5").on('click', function (e) {
//    $("#helpContent_5").show();
//});
$(".signature-options .signer-acclink").on("click", function (e) {
    var s = $(this).attr("id"),
        t = s.split("_");

    if (("#signerContent_" + t[1] == "#signerContent_2")) {
        if (connection_final == null) {
            SetConnectionPort(PortList);
        }
    }
    if (("#signerContent_" + t[1] == "#signerContent_2") && ($("#hdnFileType").val() == "HASH")) {
        ShowHidePleaseWait('N');
        $('#imgFollow').hide();
        $("#msgcontent").attr("class", "info");
        $('#msgcontent').html("Digital Signature is not applicable for HASH signing.");
        $("#btnmsgcancel").hide();
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
        return false;
    }

    if ($("#signerContent_" + t[1]).hasClass("open") != true) {
        $(".signer-content").slideUp();
        $(".signer-content").removeClass("open");
        $("#signerContent_" + t[1]).slideDown().addClass("open");
        $("#fpdevice").val("select");
        $("#div-Capture").hide();
        $("#FPimage").hide();
        $("#btnBioSign").hide();
        $("input:radio").attr("checked", false);
        $("#chkdeclaration").attr("checked", false);
        if ($("#hdneSignAuthmode").val() == "3") {
            $("#divBiometric").show();
        } else {
            $("#divBiometric").hide();
        }

    } else {
        $(".signer-content").slideUp();
        $(".signer-content").removeClass("open");
        $("#fpdevice").val("select");
        $("#div-Capture").hide();
        $("#FPimage").hide();
        $("#btnBioSign").hide();
        $("input:radio").attr("checked", false);
        $("#chkdeclaration").attr("checked", false);
        if ($("#hdneSignAuthmode").val() == "3") {
            $("#divBiometric").show();
        } else {
            $("#divBiometric").hide();
        }
    }

});

$('#btneesignature').on("click", function () {
    if (connection_final == null) {
        SetConnectionPort(PortList);
    }
    ShowHidePleaseWait('Y');
    $('#signature canvas').remove();
    $(".signer-content").slideUp();
    $(".signer-content").removeClass("open");
    var FileType = $("#hdnFileType").val();
    var SelectedValue, selectedSignaturePosition;
    if (FileType == "PDF") {
        var IsCustomizeds = $("#IsCustomized").val();
        if (IsCustomizeds == "True") {
            SelectedValue = $('#ddlPageSelection option:selected').val();
            selectedSignaturePosition = $('#ddlSignaturePosition option:selected').val();
            if (SelectedValue == "SPECIFY") {
                if ($('#txtPageNumber').val() == "") {
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html("Enter Pageno");
                    $(".alertWindow").css({ 'display': "block" });
                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                    ShowHidePleaseWait('N');
                    return false;
                }
                if ($('#txtPageNumber').val() != "") {
                    var length = Specifyval;
                    if (length == 0) {
                        $("#btnmsgcancel").hide();
                        $("#msgcontent").attr("class", "info");
                        $('#msgcontent').html("Please click on apply button to save page settings");
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                        ShowHidePleaseWait('N');
                        return false;
                    }
                }
                var csvPageNumbers = $('#hdnPageNumber').val().split(',');
                if (csvPageNumbers == "") {
                    //$('#btnmsgok').removeAttr('onClick');
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html("Please click on apply button to save page settings");
                    $(".alertWindow").css({ 'display': "block" });
                    //$('#btnmsgok').attr('onclick', "");
                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                    ShowHidePleaseWait('N');
                    return false;
                }
            }
            if (SelectedValue == "PAGE LEVEL") {
                var currentId = 1;
                var signatorylength = $(".Signatory" + currentId).length;
                var config = "";
                for (i = 1; i <= signatorylength; i++) {
                    var Page = $('#fieldPagination_' + i + ' option:selected').val();
                    var id1 = $('#draggableDiv_' + currentId + '_' + i)[0];
                    var Width = id1.offsetWidth;
                    var Height = id1.offsetHeight;
                    var Left = id1.offsetLeft;
                    var Top = id1.offsetTop;
                    Top = $('.documentVisual img').height() - Top;
                    Height = (Number(Top) - Number(Height));
                    Width = (Number(Left) + Number(Width));
                    config += Page + ',' + Left + ',' + Top + ',' + Width + ',' + Height + ';';

                    Coordinates = Page + ',' + Left + ',' + Top + ',' + Width + ',' + Height;
                    updCord = "true";
                    customselectPage = "true";
                }
                config = config.substring(0, config.length - 1);
                var pageNumbers = config;
                $("#hdnPagelevelCordinates").val(pageNumbers);
                $("#hdnCoordinates").val(pageNumbers);
            }
        }


        Validatecoordinate()
        $("#btneSignature").show();
        $("#btnDigitalsign").hide();
        $("#div-Signtypes").hide();
        $("#btneesignature").attr("href", "#Signaturedropdown");
        $("#btneesignature").attr("data-toggle", "modal");
        $("#txtFullName").val(DisplayName);
        $(".font-sign").text(DisplayName);
        $('input[name="backimg"]').attr('checked', false);
        $("#Signaturedropdown .sign-font-option li").removeClass("selected");
        $("#txtsignatureimage").val('');
        $("#lblerrormessage").text("");
        $('#SignatureImage').val("");
        $('#hdnFilePath').val("");
        $("#hdnSignatureImageOption").val("");

        if ($("#SelectFontOption").val() == "False") {
            //$("#innertabLink_1").removeClass('active');
            //$("#innertabContent_1").hide();
            if ($("#DrawSignatureOption").val() == "True") {
                $("#innertabLink_2").addClass('active');
                $("#innertabContent_2").show();
                $("#innertabLink_1").removeClass('active');
                $("#innertabLink_3").removeClass('active');
                $("#innertabLink_4").removeClass('active');
                $("#innertabContent_1").hide();
                $("#innertabContent_3").hide();
                $("#innertabContent_4").hide();
                $("#hdnSignatureImageOption").val(2);
                $("#signature").jSignature({
                    'background-color': 'transparent',
                    'decor-color': 'transparent',
                    'lineWidth': 5,
                    'height': 204
                });

            }
            else if ($("#UploadSignatureOption").val() == "True") {
                $("#innertabLink_3").addClass('active');
                $("#innertabContent_3").show();
                $("#innertabLink_1").removeClass('active');
                $("#innertabLink_2").removeClass('active');
                $("#innertabLink_4").removeClass('active');
                $("#innertabContent_1").hide();
                $("#innertabContent_2").hide();
                $("#innertabContent_4").hide();
            }
            else {
                $("#innertabLink_4").addClass('active');
                $("#innertabContent_4").show();
                $("#innertabLink_1").removeClass('active');
                $("#innertabLink_2").removeClass('active');
                $("#innertabLink_3").removeClass('active');
                $("#innertabContent_1").hide();
                $("#innertabContent_2").hide();
                $("#innertabContent_3").hide();

            }

        }
        else {
            $("#innertabLink_1").addClass('active');
            $("#innertabContent_1").show();
            $("#innertabLink_2").removeClass('active');
            $("#innertabLink_3").removeClass('active');
            $("#innertabLink_4").removeClass('active');
            $("#innertabContent_2").hide();
            $("#innertabContent_3").hide();
            $("#innertabContent_4").hide();
        }



        //    $("#innertabLink_1").addClass('active');
        //$("#innertabLink_2").removeClass('active');
        //$("#innertabLink_3").removeClass('active');
        //$("#innertabLink_4").removeClass('active');
        //   $("#innertabContent_1").show();
        //$("#innertabContent_2").hide();
        //$("#innertabContent_3").hide();
        //$("#innertabContent_4").hide();
        ShowHidePleaseWait('N');
    }
    else {
        ShowHidePleaseWait('N');
        $('#imgFollow').hide();
        $("#msgcontent").attr("class", "info");
        $('#msgcontent').html("eSignature is not applicable for XML, Data and HASH signing.");
        $("#btnmsgcancel").hide();
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
    }
});

$('#btnSignatureImage').fileupload({
    maxFileSize: 5000000,
    url: SaveBackgroundImageURL,
    formData: function (form) {
        return [ { name: "__RequestVerificationToken", value: $('[name= "__RequestVerificationToken"]').val() }];
    },
    add: function (e, data) {
        if (data.files[0].type != "image/jpeg" && data.files[0].type != "image/png") {
            $("#lblerrormessage").text("NOTE: Only .jpg..jpeg and .png files can be set as Signature Image.").attr('style', 'color: red;');
            $("#hdnSignatureImageOption").val("");
            return false;
        }
        if (data.files[0].size <= AttachmentSize && data.files[0].size >= AttachmentMinSize) {
            data.submit();
        }
        else {
            $("#lblerrormessage").text(MessageForAttachmentSize).attr('style', 'color: red;');
            $("#hdnSignatureImageOption").val("");
            return false;
        }
    },
    success: function (data, status) {
        if (data.status == 1) {
            $('#txtsignatureimage').val(data.FileName);
            $('#hdnFilePath').val(data.FileName);
            $("input[name='SignatureImage']").val("");
            $("#hdnSignatureImageOption").val(3);
            $("#hdnFilePath").val(data.FileName);
            $("#hdnPreviewesImageData").val(data.filedata);
            $("#lblerrormessage").text("");
        }
        else {
            $("#lblerrormessage").text("Invalid file format.").attr('style', 'color: red;');
            $("#hdnSignatureImageOption").val("");
            return false;
        }
    },
    done: function (e, data) {
    },
    error: function (error) {
    }
});
$("#languages").change(function () {
    var ddlLanguage = $("#languages").val();
    ShowHidePleaseWait('Y');
    $("#eSignconsent").empty();
    $.ajax({
        url: ChangeLanguageUrl,
        type: "POST",
        data: { "Language": ddlLanguage, __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
        dataType: "json",
        success: function (data) {
            if (data.status == 1) {
                ShowHidePleaseWait('N');
                $("#eSignconsent").text(data.ConsentData);
            }
            else {
                ShowHidePleaseWait('N');
            }
        },
        error: function (e) {
            ShowHidePleaseWait('N');
        }
    });
});
function Validatecoordinate() {
    var Noofpages = $('#hdnNoOfPages').val();
    var SelectedValue;
    var selectedSignaturePosition;
    var IsCustomizeds = $("#IsCustomized").val();
    if (IsCustomizeds == "True") {
        SelectedValue = $('#ddlPageSelection option:selected').val();
        selectedSignaturePosition = $('#ddlSignaturePosition option:selected').val();
    }
    else {
        SelectedValue = $('#hdnSelectPage').val();
        selectedSignaturePosition = $('#hdnSigPosition').val();
    }

    if (SelectedValue != "PAGE LEVEL") {
        var pageNumbers = "";
        if (SelectedValue == "SPECIFY") {
            var csvPageNumbers = $('#hdnPageNumber').val().split(',');
            if (csvPageNumbers == "") {
                $('#btnmsgok').removeAttr('onClick');
                $("#btnmsgcancel").hide();
                $("#msgcontent").attr("class", "info");
                $('#msgcontent').html("Please click on apply button to save page settings");
                $(".alertWindow").css({ 'display': "block" });
                $('#btnmsgok').attr('onclick', "");
                $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                return false;
            }
            for (i = 0; i < csvPageNumbers.length; i++) {
                if (csvPageNumbers[i] != "") {
                    if (parseInt(csvPageNumbers[i]) > parseInt(Noofpages)) {
                        window.location.href = '/eMsecure/SignerGateway/InvalidPageNumber';
                        return false;
                    }
                }
            }
        }
        else {
            pageNumbers = "empty";
        }
        if (SelectedValue == "EVEN") {
            if (Noofpages == "1") {
                window.location.href = '/eMsecure/SignerGateway/InvalidPageNumber';
                return false;
            }
        }
    }
    else {
        var pageNumber = "";
        var pagelevel = $("#hdnPagelevelCordinates").val().split(';');
        for (i = 0; i < pagelevel.length; i++) {
            var Page = pagelevel[i].split(',');
            pageNumber = pageNumber + Page[0] + ',';
        }
        var pages = pageNumber.slice(0, -1);
        var csvPageNumbers = pages.split(',');
        for (i = 0; i < csvPageNumbers.length; i++) {
            if (csvPageNumbers[i] != "") {
                if (parseInt(csvPageNumbers[i]) > parseInt(Noofpages)) {
                    window.location.href = '/eMsecure/SignerGateway/InvalidPageNumber';
                    return false;
                }
            }
        }
    }
}
//-----------Biometric Signing ------------------------------
$(".theme-group label").on("click", function () {
    var check_value = $("input[name='esignAuth']:checked").val();
    if (check_value == "Biometric") {
        $("#divBiometric").slideDown();
        $("#btnGetOtp").hide();
        $("#divBiometricMsg").slideUp();
        var ddldevice = document.getElementById("fpdevice");
        $("#fpdevice").val('select');
        $("#div-Capture").hide();
        $("#imgbiometric").attr('src', '/Assets/images/NotConnected.jpg');
        $("#div-Capture").hide();
        $("#FPimage").hide();
        $("#btnBioSign").hide();
        $("#otpdetails").slideUp();
    }
    else {
        $("#divBiometric").slideUp();
        $("#btnGetOtp").show();
        $("#otpdetails").slideUp();
        $("#btnGetOtp").attr("value", "Get OTP");
    }
});

$("#btnfbcapture").on('click', function () {
    ShowHidePleaseWait('Y');
    var ddldevice = document.getElementById("fpdevice");
    if (ddldevice.value == "select") {
        ShowHidePleaseWait('N');
        $("#divBiometricMsg").slideUp();
        $("#div-Capture").slideUp();
        $("#FPimage").slideUp();
        return false;
    }
    $('.imgLoader').find('div').remove();
    $('#DivLoading .imgLoader').addClass("txtLoader txtLoaderCenter");
    $('#DivLoading .imgLoader').prepend('<div>Place the finger on the biometric sensor</div>');
    var live = esignLive == "False" ? 'PP' : 'P';
    var value = window.btoa(ddldevice.value + "|" + live + "|" + WADHValue);
    jsonp(CaptureBiometricURL + value + "&callback=?",
        function (result) {
            if (result != null) {
                if (result.status == 1) {
                    ShowHidePleaseWait('N');
                    $('.imgLoader').find('div').remove();
                    $("#hdnResponse").val(result.responseData.captureResponse);
                    $("#btnBioSign").show();
                    $("#imgbiometric").attr('src', '/Assets/images/Captured.jpg');
                }
                else {
                    ShowHidePleaseWait('N');
                    $('.imgLoader').find('div').remove();
                    $("#btnBioSign").hide();
                    $("#imgbiometric").attr('src', '/Assets/images/Connected.jpg');
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html(result.errorMessage);
                    $(".alertWindow").css({ 'display': "block" });
                    $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
                }
            }
            else {
                ShowHidePleaseWait('N');
                $('.imgLoader').find('div').remove();
                $("#btnBioSign").hide();
                $("#imgbiometric").attr('src', '/Assets/images/Connected.jpg');
                $("#btnmsgcancel").hide();
                $("#msgcontent").attr("class", "info");
                $('#msgcontent').html(result.errorMessage);
                $(".alertWindow").css({ 'display': "block" });
                $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
            }
        });
});

$("#fpdevice").change(function () {
    ShowHidePleaseWait('Y');
    var ddldevice = document.getElementById("fpdevice");
    if (ddldevice.value == "select") {
        ShowHidePleaseWait('N');
        $("#divBiometricMsg").slideUp();
        $("#div-Capture").slideUp();
        $("#FPimage").slideUp();
        return false;
    }
    var Base64Devicename = window.btoa(ddldevice.value);

    jsonp(BiometricDeviceConfigURL + Base64Devicename + "&callback=?",
        function (result) {
            if (result.status == 1) {
                ShowHidePleaseWait('N');
                $("#imgbiometric").attr('src', '/Assets/images/Connected.jpg');
                $("#btnmsgcancel").hide();
                $("#divBiometricMsg").slideUp();
                $("#div-Capture").slideDown();
                $("#FPimage").slideDown();
                $("#btnBioSign").hide();
            }
            else {
                ShowHidePleaseWait('N');
                $("#btnmsgcancel").hide();
                $("#div-Capture").slideUp();
                $("#FPimage").slideUp();
                $("#btnBioSign").hide();
                $("#divBiometricMsg").slideDown();
                return false;
            }
        });
});

function ApplyImage() {
    $("#imgbiometric").attr('src', '/Assets/images/Connected.jpg');
    $('.alertWindow, .utilityWindow').hide();
}

function jsonp(url, callback) {
    // create a unique id
    var id = "_" + (new Date()).getTime();

    // create a global callback handler
    window[id] = function (result) {
        if (callback)
            callback(result);

        var sc = document.getElementById(id);
        sc.parentNode.removeChild(sc);
        window[id] = null;
    }

    url = url.replace("callback=?", "callback=" + id);

    var script = document.createElement("script");
    script.setAttribute("id", id);
    script.setAttribute("src", url);
    script.onerror = ErrorFunc;
    script.setAttribute("type", "text/javascript");
    document.body.appendChild(script);
}

function ErrorFunc(id) {
    var sc = document.getElementById(id);
    if (sc != null) {
        sc.parentNode.removeChild(sc);
        window[id] = null;
    }
    ShowHidePleaseWait('N');
    $("#div-Capture").slideUp();
    $("#FPimage").slideUp();
    $("#divBiometricMsg").slideDown();
    $("#btnBioSign").hide();
    $("#imgbiometric").attr('src', '/Assets/images/NotConnected.jpg');
    $("#btnmsgcancel").hide();
    $("#msgcontent").attr("class", "error");
    $('#msgcontent').html("Unable to call eMudhra Helper Service. Please ensure it is installed and running.");
    $(".alertWindow").css({ 'display': "block" });
    $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
}



$("#btneIDAS").on('click', function () {
    eIDAS();
})

function eIDAS() {
    var Filename = $("#hdnFileFullPath").val();
    $.ajax({
        url: eIDASURL,
        type: "GET",
        data: { "FileName": Filename, __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
        // dataType: "json",
        success: function (data) {
            window.location.href = data;
        }
    });
}

function closeesignmodal() {
    $("#eSignAuthModel").hide();
    $("#eSignAuthModel").modal('hide');
    $("#vSignAuthModel").hide();
    $("#vSignAuthModel").modal('hide');
    ShowHidePleaseWait('N');
    window.location.href = '/eMsecure/V3_0/SendSuccessResponse';

}

function closemodalWindow() {
    $("#vSignAuthModel").hide();
    $("#vSignAuthModel").modal('hide');
    ShowHidePleaseWait('N');
    window.location.href = '/eMsecure/V3_0/SendErrorResponse';
    return false;
}

//#signerLink_7
$("#signerLink_4,#btnesignv2,#signerLink_14,#signerLink_7").on("click", function () {

    ShowHidePleaseWait('Y');
    var SignType = 0;
    var signID = $(this).attr('id');
    if (signID == "signerLink_4") {
        SignType = 8;
        $("#signerLink_4").attr("href", "#vSignAuthModel");
        $("#signerLink_4").attr("data-toggle", "modal");
    }
    else if (signID == "signerLink_14") {
        SignType = 14;
        $("#signerLink_14").attr("href", "#vSignAuthModel");
        $("#signerLink_14").attr("data-toggle", "modal");
    }
    else {
        SignType = 12;
        $("#btnesignv2").attr("href", "#vSignAuthModel");
        //$("#signerLink_7").attr("href", "#vSignAuthModel");
        //$("#signerLink_7").attr("data-toggle", "modal");
        $("#btnesignv2").attr("data-toggle", "modal");
    }
    var IsCompressed = $("#hdnIsCompressed").val();
    var Base64FileData = $("#hdnBase64FileData").val();
    var AuthToken = $("#hdnAuthToken").val();
    var Name = $("#hdnName").val();
    var FileType = $("#hdnFileType").val();
    var DocEdata = $("#hdnDocumentdetails").val();
    var DataHash = $("#hdnDataHash").val();
    var IsCustomizeds = $("#IsCustomized").val();
    if (FileType != "PDF" && (signID == "signerLink_4" || signID == "signerLink_14" || signID == "signerLink_7")) {
        ShowHidePleaseWait('N');
        $('#imgFollow').hide();
        $("#msgcontent").attr("class", "info");
        if (signID == "signerLink_14") {
            $('#msgcontent').html("eSign 2.1 (Powered by CDSL) is not applicable for DATA, XML and HASH signing.");
        } else if (signID == "signerLink_4") {
            $('#msgcontent').html("eSign (Powered by Verasys) is not applicable for DATA, XML and HASH signing.");
        } else {
            $('#msgcontent').html("eSign v2.1 (Powered by eMudhra) is not applicable for DATA, XML and HASH signing.");
        }
        $("#btnmsgcancel").hide();
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
        return false;
    }

    if (FileType != "PDF" && signID == "btnesignv2") {
        ShowHidePleaseWait('N');
        $('#imgFollow').hide();
        $("#msgcontent").attr("class", "info");
        $('#msgcontent').html("eSign V2 is not applicable for DATA, XML and HASH signing.");
        $("#btnmsgcancel").hide();
        $(".alertWindow").css({ 'display': "block" });
        $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
        return false;
    }

    if (FileType == "PDF") {
        var gReason = $("#hdReason").val();
        var gLocation = $("#hdLocation").val();
        var SelectedValue, selectedSignaturePosition;
        if (IsCustomizeds == "True") {
            SelectedValue = $('#ddlPageSelection option:selected').val();
            selectedSignaturePosition = $('#ddlSignaturePosition option:selected').val();
            if (SelectedValue == "SPECIFY") {
                if ($('#txtPageNumber').val() == "") {
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html("Enter Pageno");
                    $(".alertWindow").css({ 'display': "block" });
                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                    ShowHidePleaseWait('N');
                    return false;
                }
                if ($('#txtPageNumber').val() != "") {
                    var length = Specifyval;
                    if (length == 0) {
                        $("#btnmsgcancel").hide();
                        $("#msgcontent").attr("class", "info");
                        $('#msgcontent').html("Please click on apply button to save page settings");
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                        ShowHidePleaseWait('N');
                        return false;
                    }
                }
                var csvPageNumbers = $('#hdnPageNumber').val().split(',');
                if (csvPageNumbers == "") {
                    //$('#btnmsgok').removeAttr('onClick');
                    $("#btnmsgcancel").hide();
                    $("#msgcontent").attr("class", "info");
                    $('#msgcontent').html("Please click on apply button to save page settings");
                    $(".alertWindow").css({ 'display': "block" });
                    //$('#btnmsgok').attr('onclick', "");
                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                    ShowHidePleaseWait('N');
                    return false;
                }
            }
            if (SelectedValue == "PAGE LEVEL") {
                var currentId = 1;
                var signatorylength = $(".Signatory" + currentId).length;
                var config = "";
                for (i = 1; i <= signatorylength; i++) {
                    var Page = $('#fieldPagination_' + i + ' option:selected').val();
                    var id1 = $('#draggableDiv_' + currentId + '_' + i)[0];
                    var Width = id1.offsetWidth;
                    var Height = id1.offsetHeight;
                    var Left = id1.offsetLeft;
                    var Top = id1.offsetTop;
                    Top = $('.documentVisual img').height() - Top;
                    Height = (Number(Top) - Number(Height));
                    Width = (Number(Left) + Number(Width));
                    config += Page + ',' + Left + ',' + Top + ',' + Width + ',' + Height + ';';

                    Coordinates = Page + ',' + Left + ',' + Top + ',' + Width + ',' + Height;
                    updCord = "true";
                    customselectPage = "true";
                }
                config = config.substring(0, config.length - 1);
                var pageNumbers = config;
                $("#hdnPagelevelCordinates").val(pageNumbers);
                $("#hdnCoordinates").val(pageNumbers);
            }
        }
    }


    if (FileType == "PDF") {
        var Pagelength = $("#hdnNoOfPages").val();
        var PageNumber = "";
        var SelectedValue;
        if (customselectPage == "true") {
            SelectedValue = $('#ddlPageSelection option:selected').val();
            //SignPosition = $('#ddlSignaturePosition option:selected').val()
        }
        else {
            SelectedValue = $("#hdnSelectPage").val();
        }

        var selectedSignaturePosition = $('#hdnSigPosition').val();
        Validatecoordinate();
        var Coordinates = "";

        if (SelectedValue == "FIRST") {
            PageNumber = 1;
        }
        else if (SelectedValue == "ALL") {
            for (i = 0; i < parseInt(Pagelength); i++) {
                PageNumber += (i + 1) + ",";
            }
        }
        else if (SelectedValue == "EVEN") {
            for (i = 0; i < Pagelength; i++) {
                if (((i + 1) % 2) == 0) {
                    PageNumber += (i + 1) + ",";
                }
            }
        }
        else if (SelectedValue == "ODD") {
            for (i = 0; i < Pagelength; i++) {
                if (((i + 1) % 2) != 0) {
                    PageNumber += (i + 1) + ",";
                }
            }
        }
        else if (SelectedValue == "LAST") {
            PageNumber = Pagelength;
        }
        var docType = $("#hdnDocType").val();
        //Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
        if (IsCustomizeds == "True") {
            Coordinates = $("#hdnCoordinates").val();
            if (Coordinates == "") {
                Coordinates = $("#hdnCustomizecoordinates").val();
                if (Coordinates == "") {
                    Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
                }
            }
        }
        else {
            Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
        }
        var InitialsCoordinates = null;
        if ($("#EnableInitials").val() == "True") { InitialsCoordinates = GetInitialsCoordinatesforSigning(); }
        if (SelectedValue == "SPECIFY") {
            PageNumber = $("#hdnPageNumber").val();
            //Coordinates = $("#hdnNewcoordinates").val();
        }
        else if (SelectedValue == "PAGE LEVEL") {
            PageNumber = $("#hdnPagelevelCordinates").val();
            Coordinates = $("#hdnPagelevelCordinates").val();
        }
        var Location = $("#txtLocation").val();
        var Reason = $("#txtReason").val();
        var DisplayName = $("#hdnName").val();
        var FileName = $("#hdnFileFullPath").val();
        var AuthenticationMode = $("#hdnAuthenticationMode").val();
        var ImageData = "";
        if ($("#hdnSignatureImageOption").val() == 1) {
            ImageData = $("#SignatureImage").val();
        }
        else if ($("#hdnSignatureImageOption").val() == 2) {
            if ($("#signature").jSignature('getData', 'native') != 0) {
                ImageData = $('#signature').jSignature('getData');
            }
            else {
                ImageData = "";
            }
        }
        else if ($("#hdnSignatureImageOption").val() == 3) {
            ImageData = $('#hdnFilePath').val();
        }
        else if ($("#hdnSignatureImageOption").val() == 4) {
            ImageData = $("#hdntopozImagevalue").val();
            $('#hdnSignatureImagevisible').val(1);
        }
        $.ajax({
            url: vSignURL,      //  eMsecure/V3_0/BulkDocumentSigningWithvsign
            type: "POST",
            dataType: "json",
            data: { "SignType": SignType, "Coordinates": Coordinates, "Page": SelectedValue, "PageNumber": PageNumber, "FileName": FileName, "AuthToken": AuthToken, "SignatureImage": ImageData, "SignatureOption": $("#hdnSignatureImageOption").val(), "Name": $("#hdnName").val(), "Cosign": $("#IsCosign").val(), "IsCompressed": IsCompressed, "Reason": gReason, "Location": gLocation, "AuthenticationMode": AuthenticationMode, "InitialsCoordinates": InitialsCoordinates, __RequestVerificationToken: $('[name= "__RequestVerificationToken"]').val() },
            success: function (data) {
                if (data.Value == "success") {
                    ShowHidePleaseWait('N');
                    var url = SignType == 14 ? CDSLSignGetway : (SignType == 8 ? vSignGetway : V2SignGetway);
                    //$('#vSignGatewayframe').attr("src", url);
                    $(location).attr('href', url);
                    return false;
                }
                else if (data.Value == "Failure") {
                    if (data.status == -2) {
                        ShowHidePleaseWait('N');
                        $('#imgFollow').hide();
                        $("#msgcontent").attr("class", "error");
                        $('#msgcontent').html(data.Message);
                        $("#btnmsgcancel").hide();
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').click(function () { $(".alertWindow").hide(); $(".modal-backdrop").hide(); });
                        $("#vSignAuthModel").css({ 'display': "none" });
                        return false;
                    } else {
                        ShowHidePleaseWait('N');
                        $("#msgcontent").attr("class", "error");
                        $('#msgcontent').html(data.Message);
                        $("#btnmsgcancel").hide();
                        //$(".alertWindow").css({ 'display': "block" });
                        $(".alertWindow").show();
                        //$('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
                        $('#btnmsgok').click(function () {
                            $(".alertWindow").hide();
                            $(".modal-backdrop").hide();
                            $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
                        });
                        $("#vSignAuthModel").css({ 'display': "none" });
                        return false;
                    }
                }
                else if (data.Value == 1) {
                    ShowHidePleaseWait('N');
                    $('#imgFollow').hide();
                    $("#msgcontent").attr("class", "error");
                    if (data.Message == "Root element is missing.") {
                        $('#msgcontent').html("Unable to connect. Please retry.");
                    }
                    else if (data.Message == "PdfReader not opened with owner password") {
                        $('#msgcontent').html("The uploaded PDF file is restricted from signing.");
                    }
                    else {
                        $('#msgcontent').html(data.Message);
                    }
                    $("#btnmsgcancel").hide();
                    $(".alertWindow").css({ 'display': "block" });

                    $("#hdnResponse").val('');
                    if (data.Message == "PdfReader not opened with owner password") {
                        $(".alertWindow").css({ 'display': "block" });
                        $('#btnmsgok').attr('onclick', "javascript:RedirectError();");
                        return false;
                    } else {
                        $('#btnmsgok').attr('onclick', "javascript:ApplyImage();");
                    }
                    return false;
                }
            },
            error: function (e) {
                ShowHidePleaseWait('N');
                $('#imgFollow').hide();
                $("#msgcontent").attr("class", "error");
                $('#msgcontent').html("Some error occured.Please try after sometime.");
                $("#btnmsgcancel").hide();
                $(".alertWindow").css({ 'display': "block" });
                $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
            }
        });
    }

});
// added for HDFC to handle multiple eventListeners
let cancelButtonClicked = false;
document.querySelector('a.pull-right').addEventListener('click', function () {
    cancelButtonClicked = true;
    // Send a message to the parent window indicating that the popup is being closed using the button
    window.opener.postMessage({ type: 'popupClosedByButtonCancel', status: 'Cancel', data: '{"popup Cancelled by user"}' }, '*');
    // Close the children window
    window.close();
});
window.addEventListener('beforeunload', handleBeforeUnload);

function handleBeforeUnload(event) {
    if (cancelButtonClicked === false) {
        window.opener.postMessage({ type: 'popupClosedbyX', status: 'Close', data: '{"popup Closed by user"}' }, '*');
    }
}
document.getElementById('signerLink_7').addEventListener('click', function () {
    // Call the function to redirect to another page
    window.removeEventListener('beforeunload', handleBeforeUnload);
});

//$("#signerLink_5").on("click", function () {

//    $("#signerContent_5").slideDown().addClass("open");
//    $("#divZoop").show();

//});

//$("#btnZoopsign").on('click', function () {

//    if ($("#txtLocation").val() == "" || $("#txtLocation").val() == null || $.trim($("#txtLocation").val()).length == 0) {
//        var Msg = "Location is required";
//        $("#btnmsgcancel").hide();
//        $('#msgcontent').html(Msg);
//        $("#msgcontent").attr("class", "info");
//        $(".alertWindow").css({ 'display': "block" });
//        $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
//        return false;
//    }
//    if ($("#txtReason").val() == "" || $("#txtReason").val() == null || $.trim($("#txtReason").val()).length == 0) {
//        var Msg = "Reason is required";
//        $("#btnmsgcancel").hide();
//        $('#msgcontent').html(Msg);
//        $("#msgcontent").attr("class", "info");
//        $(".alertWindow").css({ 'display': "block" });
//        $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
//        return false;
//    }


//    ShowHidePleaseWait('Y');
//    $("#signerLink_5").attr("href", "#NsdlSignAuthModel");
//    $("#signerLink_5").attr("data-toggle", "modal");
//    var IsCompressed = $("#hdnIsCompressed").val();
//    var Base64FileData = $("#hdnBase64FileData").val();
//    var AuthToken = $("#hdnAuthToken").val();
//    var Name = $("#hdnName").val();
//    var FileType = $("#hdnFileType").val();
//    var DocEdata = $("#hdnDocumentdetails").val();
//    var DataHash = $("#hdnDataHash").val();
//    var IsCustomizeds = $("#IsCustomized").val();


//    if (FileType != "PDF") {
//        ShowHidePleaseWait('N');
//        $('#imgFollow').hide();
//        $("#msgcontent").attr("class", "info");
//        $('#msgcontent').html("eSign (NSDL) is not applicable for DATA, XML and HASH signing.");
//        $("#btnmsgcancel").hide();
//        $(".alertWindow").css({ 'display': "block" });
//        $('#btnmsgok').attr('href', "javascript:Returncontrol('Y','');");
//        return false;
//    }

//    if (FileType == "PDF") {
//        var gReason = $("#hdReason").val();
//        var gLocation = $("#hdLocation").val();
//        var SelectedValue, selectedSignaturePosition;
//        if (IsCustomizeds == "True") {
//            SelectedValue = $('#ddlPageSelection option:selected').val();
//            selectedSignaturePosition = $('#ddlSignaturePosition option:selected').val();
//            if (SelectedValue == "SPECIFY") {
//                if ($('#txtPageNumber').val() == "") {
//                    $("#btnmsgcancel").hide();
//                    $("#msgcontent").attr("class", "info");
//                    $('#msgcontent').html("Enter Pageno");
//                    $(".alertWindow").css({ 'display': "block" });
//                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
//                    ShowHidePleaseWait('N');
//                    return false;
//                }
//                if ($('#txtPageNumber').val() != "") {
//                    var length = Specifyval;
//                    if (length == 0) {
//                        $("#btnmsgcancel").hide();
//                        $("#msgcontent").attr("class", "info");
//                        $('#msgcontent').html("Please click on apply button to save page settings");
//                        $(".alertWindow").css({ 'display': "block" });
//                        $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
//                        ShowHidePleaseWait('N');
//                        return false;
//                    }
//                }
//                var csvPageNumbers = $('#hdnPageNumber').val().split(',');
//                if (csvPageNumbers == "") {
//                    //$('#btnmsgok').removeAttr('onClick');
//                    $("#btnmsgcancel").hide();
//                    $("#msgcontent").attr("class", "info");
//                    $('#msgcontent').html("Please click on apply button to save page settings");
//                    $(".alertWindow").css({ 'display': "block" });
//                    //$('#btnmsgok').attr('onclick', "");
//                    $('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
//                    ShowHidePleaseWait('N');
//                    return false;
//                }
//            }
//            if (SelectedValue == "PAGE LEVEL") {
//                var currentId = 1;
//                var signatorylength = $(".Signatory" + currentId).length;
//                var config = "";
//                for (i = 1; i <= signatorylength; i++) {
//                    var Page = $('#fieldPagination_' + i + ' option:selected').val();
//                    var id1 = $('#draggableDiv_' + currentId + '_' + i)[0];
//                    var Width = id1.offsetWidth;
//                    var Height = id1.offsetHeight;
//                    var Left = id1.offsetLeft;
//                    var Top = id1.offsetTop;
//                    Top = $('.documentVisual img').height() - Top;
//                    Height = (Number(Top) - Number(Height));
//                    Width = (Number(Left) + Number(Width));
//                    config += Page + ',' + Left + ',' + Top + ',' + Width + ',' + Height + ';';

//                    Coordinates = Page + ',' + Left + ',' + Top + ',' + Width + ',' + Height;
//                    updCord = "true";
//                    customselectPage = "true";
//                }
//                config = config.substring(0, config.length - 1);
//                var pageNumbers = config;
//                $("#hdnPagelevelCordinates").val(pageNumbers);
//                $("#hdnCoordinates").val(pageNumbers);
//            }
//        }
//    }


//    if (FileType == "PDF") {
//        var Pagelength = $("#hdnNoOfPages").val();
//        var PageNumber = "";
//        var SelectedValue;
//        if (customselectPage == "true") {
//            SelectedValue = $('#ddlPageSelection option:selected').val();
//            //SignPosition = $('#ddlSignaturePosition option:selected').val()
//        }
//        else {
//            SelectedValue = $("#hdnSelectPage").val();
//        }

//        var selectedSignaturePosition = $('#hdnSigPosition').val();
//        Validatecoordinate();
//        var Coordinates = "";

//        if (SelectedValue == "FIRST") {
//            PageNumber = 1;
//        }
//        else if (SelectedValue == "ALL") {
//            for (i = 0; i < parseInt(Pagelength); i++) {
//                PageNumber += (i + 1) + ",";
//            }
//        }
//        else if (SelectedValue == "EVEN") {
//            for (i = 0; i < Pagelength; i++) {
//                if (((i + 1) % 2) == 0) {
//                    PageNumber += (i + 1) + ",";
//                }
//            }
//        }
//        else if (SelectedValue == "ODD") {
//            for (i = 0; i < Pagelength; i++) {
//                if (((i + 1) % 2) != 0) {
//                    PageNumber += (i + 1) + ",";
//                }
//            }
//        }
//        else if (SelectedValue == "LAST") {
//            PageNumber = Pagelength;
//        }
//        var docType = $("#hdnDocType").val();
//        //Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
//        if (IsCustomizeds == "True") {
//            Coordinates = $("#hdnCoordinates").val();
//            if (Coordinates == "") {
//                Coordinates = $("#hdnCustomizecoordinates").val();
//                if (Coordinates == "") {
//                    Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
//                }
//            }
//        }
//        else {
//            Coordinates = GetCoordinates($("#hdnSigPosition").val(), docType);
//        }
//        if (SelectedValue == "SPECIFY") {
//            PageNumber = $("#hdnPageNumber").val();
//            //Coordinates = $("#hdnNewcoordinates").val();
//        }
//        else if (SelectedValue == "PAGE LEVEL") {
//            PageNumber = $("#hdnPagelevelCordinates").val();
//            Coordinates = $("#hdnPagelevelCordinates").val();
//        }
//        var Location = $("#txtLocation").val();
//        var Reason = $("#txtReason").val();
//        var DisplayName = $("#hdnName").val();
//        var FileName = $("#hdnFileFullPath").val();
//        var ImageData = "";
//        if ($("#hdnSignatureImageOption").val() == 1) {
//            ImageData = $("#SignatureImage").val();
//        }
//        else if ($("#hdnSignatureImageOption").val() == 2) {
//            if ($("#signature").jSignature('getData', 'native') != 0) {
//                ImageData = $('#signature').jSignature('getData');
//            }
//            else {
//                ImageData = "";
//            }
//        }
//        else if ($("#hdnSignatureImageOption").val() == 3) {
//            ImageData = $('#hdnFilePath').val();
//        }
//        else if ($("#hdnSignatureImageOption").val() == 4) {
//            ImageData = $("#hdntopozImagevalue").val();
//            $('#hdnSignatureImagevisible').val(1);
//        }
//        var InitialsCoordinates = null;
//        if ($("#EnableInitials").val() == "True") { InitialsCoordinates = GetInitialsCoordinatesforSigning(); }

//        if (SelectedValue == "EVEN" || SelectedValue == "ODD" || SelectedValue == "SPECIFY" || SelectedValue == "PAGE LEVEL") {
//            window.ShowHidePleaseWait('N');
//            var Msg = "The selected configuration mode is not applicable for eSign(NSDL).";
//            $("#btnmsgcancel").hide();
//            $('#msgcontent').html(Msg);
//            $("#msgcontent").attr("class", "info");
//            $(".alertWindow").css({ 'display': "block" });
//            $('#btnmsgok').attr('onclick', "javascript:Returncontrol('Y','');");
//            $("#txtLocation").val('');
//            $("#txtReason").val('');
//            return false;
//        }

//        $.ajax({
//            url: NSDLUrl,      //  eMsecure/V3_0/BulkDocumentSigningWithNSDL
//            type: "POST",
//            dataType: "json",
//            data: { "Coordinates": Coordinates, "Page": SelectedValue, "PageNumber": PageNumber, "FileName": FileName, "AuthToken": AuthToken, "SignatureImage": ImageData, "SignatureOption": $("#hdnSignatureImageOption").val(), "Name": $("#hdnName").val(), "Cosign": $("#IsCosign").val(), "IsCompressed": IsCompressed, "Reason": $("#txtReason").val(), "Location": $("#txtLocation").val(), "InitialsCoordinates": InitialsCoordinates },
//            success: function (data) {
//                if (data.Value == "success") {
//                    ShowHidePleaseWait('N');
//                    //$('#vSignGatewayframe').attr("src", url);
//                    zoop.setEnvironment("staging");
//                    zoop.eSignGatewayInit(gatewayOptions);
//                    // Pass the transaction ID created at Init call
//                    zoop.eSignGateway(data.Redirect);
//                    $("#NsdlSignAuthModel").modal('show');
//                    return false;
//                }
//                else if (data.Value == "Failure") {
//                    if (data.status == -2) {
//                        ShowHidePleaseWait('N');
//                        $('#imgFollow').hide();
//                        $("#msgcontent").attr("class", "error");
//                        $('#msgcontent').html(data.Message);
//                        $("#btnmsgcancel").hide();
//                        $(".alertWindow").css({ 'display': "block" });
//                        $('#btnmsgok').click(function () { $(".alertWindow").hide(); $(".modal-backdrop").hide(); });
//                        $("#eSignAuthModel").css({ 'display': "none" });
//                        return false;
//                    } else {
//                        ShowHidePleaseWait('N');
//                        $("#msgcontent").attr("class", "error");
//                        $('#msgcontent').html(data.Message);
//                        $("#btnmsgcancel").hide();
//                        //$(".alertWindow").css({ 'display': "block" });
//                        $(".alertWindow").show();
//                        //$('#btnmsgok').attr("href", "javascript:Returncontrol('Y','');");
//                        $('#btnmsgok').click(function () {
//                            $(".alertWindow").hide();
//                            $(".modal-backdrop").hide();
//                            $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
//                        });
//                        $("#eSignAuthModel").css({ 'display': "none" });
//                        return false;
//                    }
//                }
//                else if (data.Value == 1) {
//                    ShowHidePleaseWait('N');
//                    $('#imgFollow').hide();
//                    $("#msgcontent").attr("class", "error");
//                    if (data.Message == "Root element is missing.") {
//                        $('#msgcontent').html("Unable to connect. Please retry.");
//                    }
//                    else if (data.Message == "PdfReader not opened with owner password") {
//                        $('#msgcontent').html("The uploaded PDF file is restricted from signing.");
//                    }
//                    else {
//                        $('#msgcontent').html(data.Message);
//                    }
//                    $("#btnmsgcancel").hide();
//                    $(".alertWindow").css({ 'display': "block" });

//                    $("#hdnResponse").val('');
//                    if (data.Message == "PdfReader not opened with owner password") {
//                        $(".alertWindow").css({ 'display': "block" });
//                        $('#btnmsgok').attr('onclick', "javascript:RedirectError();");
//                        return false;
//                    } else {
//                        $('#btnmsgok').attr('onclick', "javascript:ApplyImage();");
//                    }



//                    return false;
//                }
//            },
//            error: function (e) {
//                ShowHidePleaseWait('N');
//                $('#imgFollow').hide();
//                $("#msgcontent").attr("class", "error");
//                $('#msgcontent').html("Some error occured.Please try after sometime.");
//                $("#btnmsgcancel").hide();
//                $(".alertWindow").css({ 'display': "block" });
//                $('#btnmsgok').attr('href', '/eMsecure/V3_0/SendErrorResponse');
//            }
//        });
//    }
//})



//zoop.on("close", (message) => {
//    $("#NsdlSignAuthModel").modal('hide');
//});
//zoop.on("esign-result", (message) => {
//    if (!message.isError) {
//        ShowHidePleaseWait('N');
//        $.ajax({
//            url: PerformeSignNSDLURL, //url: "/eMsecure/SignerGateway/PerformeSignNSDL",
//            type: "GET",
//            dataType: "json",
//            async: false,
//            success: function (data) {
//                if (data.Value == "success") {
//                    $("#NsdlSignAuthModel").hide();
//                    $("#NsdlSignAuthModel").modal('hide');
//                    ShowHidePleaseWait('N');
//                    window.location.href = '/eMsecure/V3_0/SendSuccessResponse';
//                }
//            },
//            error: function (e) {
//                $("#NsdlSignAuthModel").modal('hide');
//            }
//        });

//    }
//    else {
//        $("#NsdlSignAuthModel").modal('hide');
//    }

//});

//zoop.on("otp-error", (message) => {
//    $("#NsdlSignAuthModel").modal('hide');
//});
//zoop.on("consent-denied", (message) => {
//    $("#NsdlSignAuthModel").modal('hide');
//});
//zoop.on("gateway-error", (message) => {
//    $("#NsdlSignAuthModel").modal('hide');
//});

